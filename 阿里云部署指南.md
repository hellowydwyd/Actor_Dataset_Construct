# 🌐 阿里云服务器部署指南

## 📊 服务器信息
- **公网IP**: 114.215.208.180
- **域名**: 灵织.cn  
- **配置**: 2核2GB
- **操作系统**: Linux (推荐Ubuntu 20.04+)

## 🚀 部署步骤

### 1. 连接服务器
```bash
ssh root@114.215.208.180
# 或使用域名
ssh root@灵织.cn
```

### 2. 准备环境
```bash
# 更新系统
sudo apt-get update && sudo apt-get upgrade -y

# 安装基础依赖
sudo apt-get install -y python3 python3-pip python3-venv git
sudo apt-get install -y libgl1-mesa-glx libglib2.0-0  # OpenCV依赖
sudo apt-get install -y fonts-wqy-microhei fonts-wqy-zenhei  # 中文字体
```

### 3. 克隆项目
```bash
cd /opt
sudo git clone https://github.com/hellowydwyd/Actor_Dataset_Construct.git
sudo chown -R www-data:www-data Actor_Dataset_Construct
cd Actor_Dataset_Construct
```

### 4. 创建虚拟环境
```bash
sudo -u www-data python3 -m venv venv
sudo -u www-data bash -c "source venv/bin/activate && pip install -r requirements-china.txt"
```

### 5. 配置API密钥
```bash
sudo -u www-data cp config/env_example .env
sudo nano .env
# 添加: TMDB_API_KEY=486ceb284a5bba2fb9dff62fb2d2c819
```

### 6. 配置系统服务
```bash
# 复制服务文件
sudo cp actor-recognition.service /etc/systemd/system/

# 启用并启动服务
sudo systemctl daemon-reload
sudo systemctl enable actor-recognition
sudo systemctl start actor-recognition

# 检查状态
sudo systemctl status actor-recognition
```

### 7. 配置Nginx（多项目共存）
```bash
# 安装Nginx（如果未安装）
sudo apt-get install -y nginx

# 复制配置文件
sudo cp nginx_actor_recognition.conf /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/nginx_actor_recognition.conf /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 重启Nginx
sudo systemctl restart nginx
```

## 🌐 访问地址

### 直接访问
- http://114.215.208.180:5001 (直接端口访问)

### 通过域名访问
- http://灵织.cn/actor/ (通过子路径访问)
- https://灵织.cn/actor/ (如果配置了SSL)

## 🔧 运维管理

### 服务管理命令
```bash
# 查看服务状态
sudo systemctl status actor-recognition

# 重启服务
sudo systemctl restart actor-recognition

# 查看日志
sudo journalctl -u actor-recognition -f

# 监控资源使用
./monitor_server.sh
```

### 更新部署
```bash
cd /opt/Actor_Dataset_Construct
sudo -u www-data git pull
sudo systemctl restart actor-recognition
```

## 💰 资源使用预估

### 内存使用
- 系统基础: 300MB
- 现有项目: 500MB (假设)
- 人脸识别系统: 1GB
- 缓冲区: 200MB
- **总计**: ~2GB ✅

### CPU使用
- 空闲时: 5-10%
- 处理图片时: 50-80%
- 视频处理时: 80-100%

## 🛡️ 安全建议

### 防火墙配置
```bash
# 开放必要端口
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 5001
sudo ufw enable
```

### 监控和备份
```bash
# 设置定时任务监控
crontab -e
# 添加: */5 * * * * /opt/Actor_Dataset_Construct/monitor_server.sh >> /var/log/actor_monitor.log
```

## 💡 多项目共存优势

✅ **共享资源**: 共用Nginx、SSL证书
✅ **域名统一**: 通过子路径区分项目  
✅ **维护简单**: 统一的运维管理
✅ **成本节约**: 无需额外服务器
