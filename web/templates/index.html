<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå½±æ¼”å‘˜äººè„¸æ•°æ®åº“æ„å»ºç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --info-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --card-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
            --border-radius: 16px;
        }

        html {
            scroll-behavior: smooth;
        }
        
        body {
            background: #f8fafc;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
        }

        .hero-section {
            background: var(--primary-gradient);
            color: white;
            padding: 40px 0 60px 0;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            background: white;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow-hover);
        }

        /* æ”¹è¿›çš„å¸ƒå±€æ ·å¼ */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .section-spacing {
            margin-bottom: 3rem;
        }

        .compact-section {
            margin-bottom: 2rem;
        }

        /* å“åº”å¼æ”¹è¿› */
        @media (max-width: 768px) {
            .hero-section {
                padding: 30px 0 40px 0;
            }
            
            .feature-card {
                margin-bottom: 1rem;
                min-height: 120px;
                padding: 1.25rem;
            }
            
            .stats-card {
                padding: 1rem;
                margin-bottom: 0.75rem;
                min-height: 120px;
            }
            
            .stats-number {
                font-size: 1.5rem;
            }
            
            .feature-icon {
                font-size: 2.5rem;
                margin-bottom: 0.75rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .main-container {
                padding: 0 10px;
            }
            
            .section-spacing {
                margin-bottom: 2rem;
            }
        }
        
        @media (max-width: 576px) {
            .display-3 {
                font-size: 2rem;
            }
            
            .feature-icon {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }
            
            .feature-card {
                min-height: 100px;
                padding: 1rem;
            }
            
            .stats-card {
                min-height: 100px;
                padding: 1rem;
            }
            
            .stats-number {
                font-size: 1.25rem;
            }
            
            .actor-preview-card {
                padding: 0.75rem;
            }
        }

        /* åŠ è½½çŠ¶æ€æ”¹è¿› */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: var(--border-radius);
            backdrop-filter: blur(8px);
        }
        
        .loading-content {
            text-align: center;
            color: #6c757d;
            padding: 2rem;
        }
        
        .loading-content .loading-spinner {
            margin-bottom: 1rem;
        }
        
        .loading-text {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .error-content {
            text-align: center;
            color: #dc3545;
            padding: 2rem;
        }
        
        .error-text {
            margin-top: 1rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* é¢„è§ˆå®¹å™¨å¢å¼º */
        .preview-container {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .preview-container.loading {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .preview-container.success {
            background: #e8f5e8;
            border: 2px solid #4caf50;
        }
        
        .preview-container.error {
            background: #ffebee;
            border: 2px solid #f44336;
        }
        
        .preview-container img {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
        }

        /* æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º */
        .file-info {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid #e9ecef;
            backdrop-filter: blur(10px);
        }
        
        .file-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: #495057;
            background: rgba(255, 255, 255, 0.7);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .info-item i {
            color: #6c757d;
            font-size: 1rem;
            min-width: 16px;
        }
        
        .info-item span {
            font-weight: 500;
            word-break: break-all;
        }
        
        /* å“åº”å¼æ–‡ä»¶ä¿¡æ¯ */
        @media (max-width: 576px) {
            .file-info-grid {
                grid-template-columns: 1fr;
            }
            
            .info-item {
                justify-content: center;
                text-align: center;
            }
        }

        /* é”™è¯¯çŠ¶æ€æ”¹è¿› */
        .alert-sm {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .retry-btn {
            transition: all 0.2s ease;
        }
        
        .retry-btn:hover {
            transform: scale(1.05);
        }

        .card-header {
            border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
            border: none;
            padding: 1.5rem;
            font-weight: 600;
        }

        .card-header.bg-primary {
            background: var(--primary-gradient) !important;
        }

        .card-header.bg-success {
            background: var(--success-gradient) !important;
        }

        .card-header.bg-info {
            background: var(--info-gradient) !important;
        }

        .card-header.bg-warning {
            background: var(--secondary-gradient) !important;
        }

        .feature-icon {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 1rem;
            display: block;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 140px;
        }

        .progress-container {
            display: none;
        }

        .progress {
            height: 8px;
            border-radius: 50px;
            background: #e2e8f0;
        }

        .progress-bar {
            border-radius: 50px;
        }

        /* è¿›åº¦æ­¥éª¤æ ·å¼ */
        .progress-steps {
            margin-top: 20px;
        }
        
        .step-item {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #dee2e6;
            transition: all 0.3s ease;
        }
        
        .step-item.active {
            background: #e3f2fd;
            border-left-color: #2196f3;
            transform: translateX(2px);
        }
        
        .step-item.completed {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        
        .step-item.error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        
        .step-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            border-radius: 50%;
            margin-right: 12px;
            color: #6c757d;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }
        
        .step-item.active .step-icon {
            background: #2196f3;
            color: white;
            border-color: #2196f3;
        }
        
        .step-item.completed .step-icon {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        .step-item.error .step-icon {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .step-title {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .step-status {
            font-size: 0.875rem;
        }
        
        .step-progress {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-card {
            margin-bottom: 15px;
            transition: all 0.2s ease;
        }

        .result-card:hover {
            transform: scale(1.02);
        }

        .similarity-badge {
            font-size: 0.9rem;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .actor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e2e8f0;
        }

        .stats-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 140px;
        }

        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .stats-label {
            color: #64748b;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
        }

        .btn {
            border-radius: 8px;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .form-control {
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(31, 41, 55, 0.9) !important;
        }

        .database-item {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .database-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .actor-preview-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            height: 100%;
        }

        .actor-preview-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        /* æ¼”å‘˜é¢„è§ˆç‰¹å®šæ ·å¼ */
        .actor-preview-card.h-100 {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .actor-preview-card.h-100:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .actor-checkbox:checked + .form-check-label {
            color: #0d6efd;
            font-weight: bold;
        }
        
        #actors-preview-section {
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç”µå½±é¢„è§ˆå¡ç‰‡æ ·å¼ */
        .movie-preview-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            height: 100%;
            border: 1px solid #e2e8f0;
        }
        
        .movie-preview-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .movie-title {
            color: #1e293b;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .movie-stats .badge {
            font-size: 0.75rem;
        }
        
        .characters-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            max-height: 250px;
            overflow-y: auto;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .character-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 0.75rem;
            border-radius: 8px;
            background: white;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            min-width: 120px;
            flex: 0 0 calc(33.333% - 0.5rem);
        }
        
        .character-item:hover {
            background: #e2e8f0;
        }
        
        .character-avatar {
            margin-bottom: 0.5rem;
        }
        
        .character-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e2e8f0;
        }
        
        .character-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
        }
        
        .character-name {
            font-weight: 600;
            font-size: 0.85rem;
            color: #1e293b;
            margin-bottom: 0.25rem;
            line-height: 1.2;
            word-break: break-word;
        }
        
        .actor-name {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            line-height: 1.2;
            word-break: break-word;
        }
        
        .character-stats {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            font-size: 0.7rem;
            width: 100%;
        }
        
        .face-count {
            color: #3b82f6;
            font-weight: 500;
        }
        
        .quality-score {
            color: #10b981;
            font-weight: 500;
        }
        
        .more-characters {
            background: #f1f5f9;
            border: 2px dashed #cbd5e1;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .character-item {
                flex: 0 0 calc(50% - 0.5rem);
                min-width: 100px;
            }
            
            .characters-grid {
                max-height: 200px;
            }
            
            .movie-preview-card {
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .character-item {
                flex: 0 0 100%;
                min-width: auto;
            }
            
            .movie-stats .badge {
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
            }
            
            .movie-title {
                font-size: 1rem;
            }
        }

        .actor-preview-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e2e8f0;
            margin-bottom: 0.5rem;
            transition: opacity 0.3s ease;
        }
        
        .actor-preview-avatar:hover {
            opacity: 0.8;
        }
        
        .avatar-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, transparent 37%, #f0f0f0 63%);
            background-size: 400% 100%;
            animation: shimmer 1.5s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .movie-tag {
            display: inline-block;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #475569;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 0.25rem;
            font-weight: 500;
        }

        .quality-bar {
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .quality-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 4rem;
            color: #cbd5e1;
            margin-bottom: 1rem;
        }

        .table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .badge {
            font-weight: 500;
            padding: 0.5rem 0.75rem;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-film"></i> æ¼”å‘˜äººè„¸æ•°æ®åº“
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#build-section">ğŸ“½ï¸ æ„å»ºæ•°æ®é›†</a>
                <a class="nav-link" href="#video-section">ğŸ¥ è§†é¢‘è¯†åˆ«</a>
                <a class="nav-link" href="#search-section">ğŸ” äººè„¸æœç´¢</a>
                <a class="nav-link" href="#database-section">ğŸ’¾ æ•°æ®åº“å†…å®¹</a>
                <a class="nav-link" href="#stats-section">ğŸ“Š æ•°æ®ç»Ÿè®¡</a>
            </div>
        </div>
    </nav>

    <!-- å¤´éƒ¨åŒºåŸŸ -->
    <section class="hero-section">
        <div class="container hero-content">
            <div class="text-center">
                <h1 class="display-3 fw-bold mb-4">ğŸ¬ ç”µå½±æ¼”å‘˜äººè„¸æ•°æ®åº“</h1>
                <p class="lead mb-5 opacity-90 mx-auto" style="max-width: 600px;">
                    åŸºäºAIæŠ€æœ¯çš„æ™ºèƒ½æ¼”å‘˜äººè„¸è¯†åˆ«ç³»ç»Ÿï¼Œè‡ªåŠ¨æ”¶é›†ã€å¤„ç†å’Œåˆ†æç”µå½±æ¼”å‘˜å›¾ç‰‡ï¼Œæ„å»ºé«˜ç²¾åº¦çš„äººè„¸ç‰¹å¾å‘é‡æ•°æ®åº“
                </p>
                
                <!-- åŠŸèƒ½ç‰¹æ€§å¡ç‰‡ -->
                <div class="row g-3 justify-content-center mb-5">
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="feature-card">
                            <i class="bi bi-robot feature-icon"></i>
                            <div class="fw-semibold fs-5">AIäººè„¸è¯†åˆ«</div>
                            <small class="opacity-75">InsightFaceæ·±åº¦å­¦ä¹ </small>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="feature-card">
                            <i class="bi bi-search feature-icon"></i>
                            <div class="fw-semibold fs-5">ç›¸ä¼¼åº¦æœç´¢</div>
                            <small class="opacity-75">å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢</small>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="feature-card">
                            <i class="bi bi-database feature-icon"></i>
                            <div class="fw-semibold fs-5">å‘é‡æ•°æ®åº“</div>
                            <small class="opacity-75">Faissé«˜æ€§èƒ½å¼•æ“</small>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="feature-card">
                            <i class="bi bi-film feature-icon"></i>
                            <div class="fw-semibold fs-5">ç”µå½±æ•°æ®</div>
                            <small class="opacity-75">TMDBç”µå½±æ•°æ®åº“</small>
                        </div>
                    </div>
                </div>

                    <!-- å¿«é€Ÿç»Ÿè®¡ -->
                <div class="row g-3 justify-content-center">
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="stats-card">
                            <div class="stats-number" id="hero-total-actors">-</div>
                            <div class="stats-label">è§’è‰²æ•°é‡</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="stats-card">
                            <div class="stats-number" id="hero-total-vectors">-</div>
                            <div class="stats-label">äººè„¸å‘é‡</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="stats-card">
                            <div class="stats-number" id="hero-total-movies">-</div>
                            <div class="stats-label">ç”µå½±æ•°é‡</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="main-container my-4">
        <!-- åŠŸèƒ½å¯¼èˆª -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body py-3">
                        <div class="d-flex flex-wrap justify-content-center gap-2">
                            <a href="#build-section" class="btn btn-outline-primary btn-sm smooth-scroll">
                                <i class="bi bi-plus-circle"></i> æ„å»ºæ•°æ®é›†
                            </a>
                            <a href="#video-section" class="btn btn-outline-dark btn-sm smooth-scroll">
                                <i class="bi bi-camera-video"></i> è§†é¢‘è¯†åˆ«
                            </a>
                            <a href="#search-section" class="btn btn-outline-success btn-sm smooth-scroll">
                                <i class="bi bi-search"></i> äººè„¸æœç´¢
                            </a>
                            <a href="#database-section" class="btn btn-outline-warning btn-sm smooth-scroll">
                                <i class="bi bi-people"></i> æ•°æ®åº“
                            </a>
                            <a href="#stats-section" class="btn btn-outline-info btn-sm smooth-scroll">
                                <i class="bi bi-graph-up"></i> ç»Ÿè®¡
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ„å»ºæ•°æ®é›†éƒ¨åˆ† -->
        <section id="build-section" class="section-spacing">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-plus-circle-fill"></i> æ„å»ºæ¼”å‘˜æ•°æ®é›†</h4>
                    <small class="opacity-75">è¾“å…¥ç”µå½±åç§°ï¼Œè‡ªåŠ¨æ”¶é›†æ¼”å‘˜äººè„¸æ•°æ®</small>
                </div>
                <div class="card-body">
                    <form id="build-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="movie-title" class="form-label">ç”µå½±åç§° *</label>
                                    <div class="input-group">
                                    <input type="text" class="form-control" id="movie-title" placeholder="è¯·è¾“å…¥ç”µå½±åç§°" required>
                                        <button type="button" class="btn btn-outline-info" id="preview-actors-btn">
                                            <i class="bi bi-eye"></i> é¢„è§ˆæ¼”å‘˜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="movie-year" class="form-label">ä¸Šæ˜ å¹´ä»½</label>
                                    <input type="number" class="form-control" id="movie-year" placeholder="å¯é€‰" min="1900" max="2030">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="max-actors" class="form-label">æœ€å¤§æ¼”å‘˜æ•°</label>
                                    <div class="input-group">
                                    <input type="number" class="form-control" id="max-actors" value="20" min="1" max="50">
                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="smart-actor-count-btn" title="æ™ºèƒ½æ¨èæ¼”å‘˜æ•°é‡">
                                            <i class="bi bi-lightbulb"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ¡†å½¢é€‰æ‹©åŒºåŸŸ -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="shape-type" class="form-label">äººè„¸æ¡†å½¢çŠ¶</label>
                                    <select class="form-select" id="shape-type">
                                        <option value="rectangle">çŸ©å½¢æ¡†</option>
                                        <option value="rounded_rectangle">åœ†è§’çŸ©å½¢</option>
                                        <option value="circle">åœ†å½¢æ¡†</option>
                                        <option value="ellipse">æ¤­åœ†æ¡†</option>
                                        <option value="diamond">è±å½¢æ¡†</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">å…è´¹å›¾ç‰‡æºçŠ¶æ€ 
                                        <button type="button" class="btn btn-outline-success btn-sm ms-2" onclick="showFreeCrawlerStatus()">
                                            <i class="bi bi-info-circle"></i> æŸ¥çœ‹è¯¦æƒ…
                                        </button>
                                    </label>
                                    <div id="free-crawler-preview" class="d-flex flex-wrap gap-1">
                                        <span class="badge bg-success">TMDB âœ“</span>
                                        <span class="badge bg-success">ç™¾åº¦å›¾ç‰‡ âœ“</span>
                                        <small class="text-muted ms-2">å…è´¹çˆ¬è™«ï¼Œä¸“æ³¨å‰§ç…§æ”¶é›†</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ¼”å‘˜é¢„è§ˆåŒºåŸŸ -->
                        <div id="actors-preview-section" class="mb-3" style="display: none;">
                            <div class="card bg-light">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="bi bi-people-fill"></i> æ¼”å‘˜é¢„è§ˆ
                                        <span id="preview-actor-count" class="badge bg-info ms-2">0</span>
                                    </h6>
                                    <button type="button" class="btn-close" onclick="hideActorsPreview()"></button>
                                </div>
                                <div class="card-body" id="actors-preview-content">
                                    <!-- æ¼”å‘˜é¢„è§ˆå†…å®¹ -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-secondary" id="search-movie-btn">
                                <i class="bi bi-search"></i> æœç´¢ç”µå½±
                            </button>
                            <button type="submit" class="btn btn-primary" id="build-btn">
                                <i class="bi bi-play-fill"></i> å¼€å§‹æ„å»º
                            </button>
                        </div>
                    </form>

                    <!-- ç”µå½±æœç´¢ç»“æœ -->
                    <div id="movie-results" class="mt-4" style="display: none;">
                        <h6>æœç´¢ç»“æœï¼š</h6>
                        <div id="movie-list"></div>
                    </div>

                    <!-- è¿›åº¦æ˜¾ç¤º -->
                    <div id="build-progress" class="progress-container mt-4">
                        <h6>æ„å»ºè¿›åº¦ï¼š</h6>
                        
                        <!-- æ€»ä½“è¿›åº¦ -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <small class="text-muted">æ€»ä½“è¿›åº¦</small>
                                <small class="text-muted" id="overall-progress-text">0%</small>
                            </div>
                            <div class="progress mb-2">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%" id="overall-progress-bar"></div>
                        </div>
                        </div>
                        
                        <!-- è¯¦ç»†è¿›åº¦æ­¥éª¤ -->
                        <div class="progress-steps">
                            <div class="step-item" id="step-movie-info">
                                <div class="d-flex align-items-center">
                                    <div class="step-icon">
                                        <i class="bi bi-film"></i>
                                    </div>
                                    <div class="step-content flex-grow-1">
                                        <div class="step-title">è·å–ç”µå½±ä¿¡æ¯</div>
                                        <div class="step-status text-muted">ç­‰å¾…ä¸­...</div>
                                    </div>
                                    <div class="step-progress">
                                        <div class="spinner-border spinner-border-sm" style="display: none;"></div>
                                        <i class="bi bi-check-circle-fill text-success" style="display: none;"></i>
                                        <i class="bi bi-x-circle-fill text-danger" style="display: none;"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-item" id="step-color-assign">
                                <div class="d-flex align-items-center">
                                    <div class="step-icon">
                                        <i class="bi bi-palette"></i>
                                    </div>
                                    <div class="step-content flex-grow-1">
                                        <div class="step-title">åˆ†é…è§’è‰²é¢œè‰²</div>
                                        <div class="step-status text-muted">ç­‰å¾…ä¸­...</div>
                                    </div>
                                    <div class="step-progress">
                                        <div class="spinner-border spinner-border-sm" style="display: none;"></div>
                                        <i class="bi bi-check-circle-fill text-success" style="display: none;"></i>
                                        <i class="bi bi-x-circle-fill text-danger" style="display: none;"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-item" id="step-collect-images">
                                <div class="d-flex align-items-center">
                                    <div class="step-icon">
                                        <i class="bi bi-images"></i>
                                    </div>
                                    <div class="step-content flex-grow-1">
                                        <div class="step-title">æ”¶é›†æ¼”å‘˜å›¾ç‰‡</div>
                                        <div class="step-status text-muted">ç­‰å¾…ä¸­...</div>
                                        <div class="progress mt-1" style="height: 4px; display: none;">
                                            <div class="progress-bar bg-info" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="step-progress">
                                        <div class="spinner-border spinner-border-sm" style="display: none;"></div>
                                        <i class="bi bi-check-circle-fill text-success" style="display: none;"></i>
                                        <i class="bi bi-x-circle-fill text-danger" style="display: none;"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-item" id="step-process-faces">
                                <div class="d-flex align-items-center">
                                    <div class="step-icon">
                                        <i class="bi bi-person-bounding-box"></i>
                                    </div>
                                    <div class="step-content flex-grow-1">
                                        <div class="step-title">å¤„ç†äººè„¸æ•°æ®</div>
                                        <div class="step-status text-muted">ç­‰å¾…ä¸­...</div>
                                        <div class="progress mt-1" style="height: 4px; display: none;">
                                            <div class="progress-bar bg-warning" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="step-progress">
                                        <div class="spinner-border spinner-border-sm" style="display: none;"></div>
                                        <i class="bi bi-check-circle-fill text-success" style="display: none;"></i>
                                        <i class="bi bi-x-circle-fill text-danger" style="display: none;"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="step-item" id="step-save-database">
                                <div class="d-flex align-items-center">
                                    <div class="step-icon">
                                        <i class="bi bi-database-fill"></i>
                                    </div>
                                    <div class="step-content flex-grow-1">
                                        <div class="step-title">ä¿å­˜åˆ°æ•°æ®åº“</div>
                                        <div class="step-status text-muted">ç­‰å¾…ä¸­...</div>
                                    </div>
                                    <div class="step-progress">
                                        <div class="spinner-border spinner-border-sm" style="display: none;"></div>
                                        <i class="bi bi-check-circle-fill text-success" style="display: none;"></i>
                                        <i class="bi bi-x-circle-fill text-danger" style="display: none;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="mt-3" id="build-stats" style="display: none;">
                            <div class="row text-center">
                                <div class="col-3">
                                    <div class="h5 mb-0" id="stat-actors">0</div>
                                    <small class="text-muted">æ¼”å‘˜</small>
                                </div>
                                <div class="col-3">
                                    <div class="h5 mb-0" id="stat-images">0</div>
                                    <small class="text-muted">å›¾ç‰‡</small>
                                </div>
                                <div class="col-3">
                                    <div class="h5 mb-0" id="stat-faces">0</div>
                                    <small class="text-muted">äººè„¸</small>
                                </div>
                                <div class="col-3">
                                    <div class="h5 mb-0" id="stat-vectors">0</div>
                                    <small class="text-muted">å‘é‡</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ„å»ºç»“æœ -->
                    <div id="build-results" class="mt-4" style="display: none;">
                        <h6>æ„å»ºç»“æœï¼š</h6>
                        <div id="build-summary"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- è§†é¢‘äººè„¸è¯†åˆ«éƒ¨åˆ† -->
        <section id="video-section" class="section-spacing">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0"><i class="bi bi-camera-video-fill"></i> è§†é¢‘äººè„¸è¯†åˆ«</h4>
                            <small class="opacity-75">ä¸Šä¼ è§†é¢‘å¸§æˆ–å›¾ç‰‡ï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶æ ‡è®°æ¼”å‘˜å§“å</small>
                        </div>
                        <button class="btn btn-light btn-sm" onclick="loadVideoActors()">
                            <i class="bi bi-people"></i> å¯è¯†åˆ«æ¼”å‘˜ (<span id="recognizable-count">-</span>)
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- ä¸Šä¼ åŒºåŸŸ -->
                        <div class="col-md-6">
                            
                            <!-- æ–‡ä»¶ä¸Šä¼  -->
                            <form id="video-frame-form" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="video-frame" class="form-label">ä¸Šä¼ è§†é¢‘æ–‡ä»¶</label>
                                    <input type="file" class="form-control" id="video-frame" 
                                           accept=".mp4,.avi,.mov,.mkv,.flv,.wmv" required>
                                    <div class="form-text" id="file-help">
                                        <strong>è§†é¢‘å¤„ç†ï¼š</strong>é€å¸§è¯†åˆ«å¹¶è¾“å‡ºå¸¦æ ‡æ³¨çš„å®Œæ•´è§†é¢‘
                                        <br><small class="text-muted">æ”¯æŒæ ¼å¼ï¼šMP4, AVI, MOV, MKV, FLV, WMV</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="similarity-threshold" class="form-label">ç›¸ä¼¼åº¦é˜ˆå€¼</label>
                                    <div class="input-group">
                                        <input type="range" class="form-range" id="similarity-threshold" 
                                               min="0.4" max="0.9" step="0.05" value="0.6">
                                        <span class="input-group-text" id="threshold-value">0.6</span>
                                    </div>
                                    <div class="form-text">è¾ƒé«˜çš„é˜ˆå€¼ä¼šå‡å°‘è¯¯è¯†åˆ«ï¼Œä½†å¯èƒ½é—æ¼ä¸€äº›äººè„¸</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="movie-scope" class="form-label">ç”µå½±èŒƒå›´é™å®š 
                                        <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                           title="é€‰æ‹©ç”µå½±å¯å°†è¯†åˆ«èŒƒå›´é™åˆ¶åœ¨è¯¥ç”µå½±çš„æ¼”å‘˜ä¸­ï¼Œæé«˜å‡†ç¡®æ€§"></i>
                                    </label>
                                    <select class="form-select" id="movie-scope">
                                        <option value="">å…¨åº“æœç´¢ï¼ˆæ‰€æœ‰æ¼”å‘˜ï¼‰</option>
                                    </select>
                                    <div class="form-text">
                                        <span class="text-success">æ¨èï¼š</span>é€‰æ‹©å¯¹åº”ç”µå½±å¯é¿å…è¯¯è¯†åˆ«ä¸ºå…¶ä»–ç”µå½±çš„ç›¸ä¼¼æ¼”å‘˜
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-dark" id="process-btn">
                                        <i class="bi bi-film"></i> <span id="process-btn-text">å¤„ç†è§†é¢‘</span>
                                    </button>
                                </div>
                            </form>

                            <!-- åŸå›¾é¢„è§ˆ -->
                            <div id="original-preview" class="mt-4" style="display: none;">
                                <h6>æ–‡ä»¶é¢„è§ˆï¼š</h6>
                                <img id="original-img" class="image-preview rounded" alt="æ–‡ä»¶é¢„è§ˆ">
                            </div>
                        </div>

                        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
                        <div class="col-md-6">
                            <!-- å¤„ç†çŠ¶æ€ -->
                            <div id="video-processing" class="text-center py-4" style="display: none;">
                                <div class="loading-spinner"></div>
                                <p class="mt-2 text-muted" id="processing-text">æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...</p>
                                <div class="progress mt-3" id="video-progress" style="display: none;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" style="width: 0%" id="progress-bar"></div>
                                </div>
                            </div>
                            
                            <!-- è¯†åˆ«ç»“æœ -->
                            <div id="video-results" style="display: none;">
                                <h6 id="result-title">è¯†åˆ«ç»“æœï¼š</h6>
                                
                                <!-- å•å¸§ç»“æœ -->
                                <div id="frame-result" style="display: none;">
                                    <img id="annotated-img" class="image-preview rounded mb-3" alt="æ ‡æ³¨ç»“æœ">
                                </div>
                                
                                <!-- è§†é¢‘ç»“æœ -->
                                <div id="video-result" style="display: none;">
                                    <div class="card bg-light mb-3">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">
                                                <i class="bi bi-check-circle-fill text-success"></i> è§†é¢‘å¤„ç†å®Œæˆ
                                            </h5>
                                            <p class="card-text">æ‚¨çš„æ ‡æ³¨è§†é¢‘å·²å‡†å¤‡å°±ç»ª</p>
                                            <button class="btn btn-success" id="download-video-btn">
                                                <i class="bi bi-download"></i> ä¸‹è½½æ ‡æ³¨è§†é¢‘
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- è¯†åˆ«ç»Ÿè®¡ -->
                                <div id="recognition-stats" class="mb-3"></div>
                                
                                <!-- è¯†åˆ«è¯¦æƒ… -->
                                <div id="recognition-details"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- äººè„¸æœç´¢éƒ¨åˆ† -->
        <section id="search-section" class="section-spacing">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="bi bi-search-heart-fill"></i> äººè„¸ç›¸ä¼¼åº¦æœç´¢</h4>
                    <small class="opacity-75">ä¸Šä¼ ç…§ç‰‡ï¼Œæ‰¾åˆ°æœ€ç›¸ä¼¼çš„æ¼”å‘˜</small>
                </div>
                <div class="card-body">
                    <form id="search-form" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="search-image" class="form-label">ä¸Šä¼ æŸ¥è¯¢å›¾ç‰‡ *</label>
                                    <input type="file" class="form-control" id="search-image" accept="image/*" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="top-k" class="form-label">è¿”å›ç»“æœæ•°</label>
                                    <input type="number" class="form-control" id="top-k" value="10" min="1" max="50">
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-success" id="search-btn">
                            <i class="bi bi-search"></i> æœç´¢ç›¸ä¼¼äººè„¸
                        </button>
                    </form>

                    <!-- å›¾ç‰‡é¢„è§ˆ -->
                    <div id="image-preview" class="mt-3" style="display: none;">
                        <h6>æŸ¥è¯¢å›¾ç‰‡ï¼š</h6>
                        <img id="preview-img" class="image-preview rounded" alt="æŸ¥è¯¢å›¾ç‰‡">
                    </div>

                    <!-- æœç´¢ç»“æœ -->
                    <div id="search-results" class="mt-4" style="display: none;">
                        <h6>æœç´¢ç»“æœï¼š</h6>
                        <div id="results-container" class="row"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ•°æ®åº“å†…å®¹é¢„è§ˆéƒ¨åˆ† -->
        <section id="database-section" class="section-spacing">
            <div class="card">
                <div class="card-header bg-warning text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0"><i class="bi bi-collection-play-fill"></i> ç”µå½±è§’è‰²æ•°æ®åº“</h4>
                            <small class="opacity-75">æŒ‰ç”µå½±åˆ†ç»„æŸ¥çœ‹è§’è‰²äººè„¸æ•°æ®</small>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-light btn-sm" id="refresh-database-btn">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                            </button>
                            <button class="btn btn-light btn-sm" id="view-all-btn">
                                <i class="bi bi-grid-3x3-gap-fill"></i> æŸ¥çœ‹å…¨éƒ¨
                            </button>
                            <button class="btn btn-warning btn-sm" id="debug-metadata-btn">
                                <i class="bi bi-bug"></i> è°ƒè¯•
                            </button>
                            <div class="btn-group">
                                <button type="button" class="btn btn-light btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="bi bi-gear-fill"></i> ç®¡ç†
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="exportMetadata()">
                                        <i class="bi bi-download"></i> å¯¼å‡ºMetadataæ–‡ä»¶
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="clearDatabase()">
                                        <i class="bi bi-trash-fill"></i> æ¸…ç©ºæ•°æ®åº“
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- å¿«é€Ÿç»Ÿè®¡ -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="stats-card text-center">
                                <div class="stats-number" id="db-total-movies">-</div>
                                <div class="stats-label">ç”µå½±æ€»æ•°</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card text-center">
                                <div class="stats-number" id="db-total-characters">-</div>
                                <div class="stats-label">è§’è‰²æ€»æ•°</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card text-center">
                                <div class="stats-number" id="db-total-faces">-</div>
                                <div class="stats-label">äººè„¸æ€»æ•°</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card text-center">
                                <div class="stats-number" id="db-avg-quality">-</div>
                                <div class="stats-label">å¹³å‡è´¨é‡</div>
                            </div>
                        </div>
                    </div>

                    <!-- ç”µå½±è§’è‰²æ•°æ®é¢„è§ˆ -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="bi bi-collection-play"></i> ç”µå½±è§’è‰²æ•°æ®åº“ <span class="badge bg-info ms-2">IMDB Character Bank Style</span></h6>
                        <small class="text-muted">æŒ‰ç”µå½±åˆ†ç»„æ˜¾ç¤ºè§’è‰²ä¿¡æ¯</small>
                    </div>
                    
                    <div id="actors-preview">
                        <div class="text-center py-4">
                            <div class="loading-spinner"></div>
                            <p class="mt-2 text-muted">åŠ è½½æ¼”å‘˜é¢„è§ˆä¸­...</p>
                        </div>
                    </div>

                    <!-- ç”µå½±åˆ†å¸ƒé¢„è§ˆ -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h6><i class="bi bi-film"></i> ç”µå½±åˆ†å¸ƒ</h6>
                            <div id="movies-preview">
                                <div class="text-center py-2">
                                    <div class="loading-spinner"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-bar-chart"></i> è´¨é‡åˆ†å¸ƒ</h6>
                            <div id="quality-preview">
                                <div class="text-center py-2">
                                    <div class="loading-spinner"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ•°æ®ç»Ÿè®¡éƒ¨åˆ† -->
        <section id="stats-section">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0"><i class="bi bi-graph-up"></i> æŠ€æœ¯ç»Ÿè®¡</h4>
                            <small class="opacity-75">å‘é‡æ•°æ®åº“æŠ€æœ¯è¯¦æƒ…</small>
                        </div>
                        <button class="btn btn-light btn-sm" id="refresh-stats-btn">
                            <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="database-stats">
                        <div class="text-center py-4">
                            <div class="loading-spinner"></div>
                            <p class="mt-2 text-muted">åŠ è½½æŠ€æœ¯ç»Ÿè®¡ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- è„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentMovieData = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            initEventListeners();
            loadInitialData();
        });

        // åŠ è½½åˆå§‹æ•°æ®
        async function loadInitialData() {
            try {
                console.log('å¼€å§‹åŠ è½½åˆå§‹æ•°æ®...');
                await Promise.all([
                  loadDatabaseStats(),
                  loadDatabaseContent(),
                  loadVideoActors(),
                  loadFreeCrawlerStatus(),
                  loadMoviesList()
              ]);
              console.log('åˆå§‹æ•°æ®åŠ è½½å®Œæˆ');
            } catch (error) {
                console.error('åˆå§‹æ•°æ®åŠ è½½å¤±è´¥:', error);
                showNotification('error', 'åˆå§‹æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            console.log('åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨...');
            
            try {
                // æœç´¢ç”µå½±æŒ‰é’®
                const searchMovieBtn = document.getElementById('search-movie-btn');
                if (searchMovieBtn) {
                    searchMovieBtn.addEventListener('click', searchMovie);
                }
                
                // æ„å»ºæ•°æ®é›†è¡¨å•
                const buildForm = document.getElementById('build-form');
                if (buildForm) {
                    buildForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        buildDataset();
                    });
                }

                // äººè„¸æœç´¢è¡¨å•
                const searchForm = document.getElementById('search-form');
                if (searchForm) {
                    searchForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        searchFace();
                    });
                }

                // å›¾ç‰‡é¢„è§ˆ
                const searchImage = document.getElementById('search-image');
                if (searchImage) {
                    searchImage.addEventListener('change', previewImage);
                }

                // åˆ·æ–°ç»Ÿè®¡æŒ‰é’®
                const refreshStatsBtn = document.getElementById('refresh-stats-btn');
                if (refreshStatsBtn) {
                    refreshStatsBtn.addEventListener('click', function() {
                        console.log('åˆ·æ–°ç»Ÿè®¡æŒ‰é’®è¢«ç‚¹å‡»');
                        refreshAllData();
                    });
                }
                
                // æ•°æ®åº“å†…å®¹ç›¸å…³äº‹ä»¶
                const refreshDatabaseBtn = document.getElementById('refresh-database-btn');
                if (refreshDatabaseBtn) {
                    refreshDatabaseBtn.addEventListener('click', function() {
                        console.log('åˆ·æ–°æ•°æ®åº“æŒ‰é’®è¢«ç‚¹å‡»');
                        refreshDatabaseData();
                    });
                }
                
                const viewAllBtn = document.getElementById('view-all-btn');
                if (viewAllBtn) {
                    viewAllBtn.addEventListener('click', viewAllActors);
                }
                
                const debugMetadataBtn = document.getElementById('debug-metadata-btn');
                if (debugMetadataBtn) {
                    debugMetadataBtn.addEventListener('click', debugMetadata);
                }
                
                // æ¼”å‘˜é¢„è§ˆæŒ‰é’®äº‹ä»¶
                const previewActorsBtn = document.getElementById('preview-actors-btn');
                if (previewActorsBtn) {
                    previewActorsBtn.addEventListener('click', previewMovieActors);
                }
                
                // æ™ºèƒ½æ¼”å‘˜æ•°é‡æ¨èæŒ‰é’®äº‹ä»¶
                const smartActorCountBtn = document.getElementById('smart-actor-count-btn');
                if (smartActorCountBtn) {
                    smartActorCountBtn.addEventListener('click', smartRecommendActorCount);
                }
                
                // è§†é¢‘è¯†åˆ«ç›¸å…³äº‹ä»¶
                const videoFrameForm = document.getElementById('video-frame-form');
                if (videoFrameForm) {
                    videoFrameForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        processVideo();
                    });
                }
                
                const videoFrame = document.getElementById('video-frame');
                if (videoFrame) {
                    videoFrame.addEventListener('change', checkFileType);
                }
                
                const similarityThreshold = document.getElementById('similarity-threshold');
                if (similarityThreshold) {
                    similarityThreshold.addEventListener('input', updateThresholdValue);
                }
                
                
                console.log('äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshAllData() {
            console.log('å¼€å§‹åˆ·æ–°æ‰€æœ‰æ•°æ®...');
            showNotification('info', 'æ­£åœ¨åˆ·æ–°æ•°æ®...');
            
            try {
                // å…ˆå¼ºåˆ¶åˆ·æ–°æ•°æ®åº“å®ä¾‹
                await refreshDatabaseInstance();
                
                // ç„¶ååˆ·æ–°æ‰€æœ‰æ˜¾ç¤ºæ•°æ®
                await Promise.all([
                    loadDatabaseStats(),
                    loadDatabaseContent(),
                    loadVideoActors()
                ]);
                showNotification('success', 'æ•°æ®åˆ·æ–°æˆåŠŸ');
                console.log('æ‰€æœ‰æ•°æ®åˆ·æ–°å®Œæˆ');
            } catch (error) {
                console.error('æ•°æ®åˆ·æ–°å¤±è´¥:', error);
                showNotification('error', 'æ•°æ®åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // å¼ºåˆ¶åˆ·æ–°æ•°æ®åº“å®ä¾‹
        async function refreshDatabaseInstance() {
            try {
                const response = await fetch('/api/refresh_database', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('æ•°æ®åº“å®ä¾‹åˆ·æ–°æˆåŠŸ:', data.stats);
                    return data.stats;
                } else {
                    console.warn('æ•°æ®åº“å®ä¾‹åˆ·æ–°å¤±è´¥:', data.error);
                    return null;
                }
            } catch (error) {
                console.error('å¼ºåˆ¶åˆ·æ–°æ•°æ®åº“å®ä¾‹å¤±è´¥:', error);
                return null;
            }
        }

        // åˆ·æ–°æ•°æ®åº“æ•°æ®
        async function refreshDatabaseData() {
            console.log('å¼€å§‹åˆ·æ–°æ•°æ®åº“æ•°æ®...');
            showNotification('info', 'æ­£åœ¨åˆ·æ–°æ•°æ®åº“æ•°æ®...');
            
            try {
                // å…ˆå¼ºåˆ¶åˆ·æ–°æ•°æ®åº“å®ä¾‹
                await refreshDatabaseInstance();
                
                // ç„¶ååˆ·æ–°æ˜¾ç¤ºæ•°æ®
                await loadDatabaseContent();
                showNotification('success', 'æ•°æ®åº“æ•°æ®åˆ·æ–°æˆåŠŸ');
                console.log('æ•°æ®åº“æ•°æ®åˆ·æ–°å®Œæˆ');
            } catch (error) {
                console.error('æ•°æ®åº“æ•°æ®åˆ·æ–°å¤±è´¥:', error);
                showNotification('error', 'æ•°æ®åº“æ•°æ®åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }


        // æœç´¢ç”µå½±
        async function searchMovie() {
            const movieTitle = document.getElementById('movie-title').value.trim();
            const movieYear = document.getElementById('movie-year').value;
            
            if (!movieTitle) {
                alert('è¯·è¾“å…¥ç”µå½±åç§°');
                return;
            }

            const searchBtn = document.getElementById('search-movie-btn');
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> æœç´¢ä¸­...';

            try {
                const response = await fetch('/api/search_movie', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        movie_title: movieTitle,
                        year: movieYear ? parseInt(movieYear) : null
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayMovieResults(data.movies);
                } else {
                    alert('æœç´¢å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('æœç´¢ç”µå½±å¤±è´¥:', error);
                alert('æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<i class="bi bi-search"></i> æœç´¢ç”µå½±';
            }
        }

        // æ˜¾ç¤ºç”µå½±æœç´¢ç»“æœ
        function displayMovieResults(movies) {
            const resultsDiv = document.getElementById('movie-results');
            const listDiv = document.getElementById('movie-list');
            
            if (movies.length === 0) {
                listDiv.innerHTML = '<p class="text-muted">æœªæ‰¾åˆ°ç›¸å…³ç”µå½±</p>';
            } else {
                const moviesHtml = movies.map(movie => `
                    <div class="card mb-2">
                        <div class="card-body py-2">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="mb-1">${movie.title}</h6>
                                    <small class="text-muted">${movie.release_date || 'N/A'} | è¯„åˆ†: ${movie.vote_average || 'N/A'}</small>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-sm btn-outline-primary" onclick="selectMovie(${movie.id}, '${movie.title}', '${movie.release_date}')">
                                        é€‰æ‹©æ­¤ç”µå½±
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                listDiv.innerHTML = moviesHtml;
            }
            
            resultsDiv.style.display = 'block';
        }

        // é€‰æ‹©ç”µå½±
        function selectMovie(movieId, title, releaseDate) {
            document.getElementById('movie-title').value = title;
            if (releaseDate) {
                document.getElementById('movie-year').value = new Date(releaseDate).getFullYear();
            }
            currentMovieData = { id: movieId, title: title, release_date: releaseDate };
            document.getElementById('movie-results').style.display = 'none';
        }

        // æ„å»ºæ•°æ®é›†
        async function buildDataset() {
            const movieTitle = document.getElementById('movie-title').value.trim();
            const movieYear = document.getElementById('movie-year').value;
            const maxActors = document.getElementById('max-actors').value;
            const shapeType = document.getElementById('shape-type').value;

            if (!movieTitle) {
                showNotification('warning', 'è¯·è¾“å…¥ç”µå½±åç§°');
                return;
            }

            const buildBtn = document.getElementById('build-btn');
            const progressDiv = document.getElementById('build-progress');

            // åˆå§‹åŒ–è¿›åº¦æ˜¾ç¤º
            initializeBuildProgress();
            
            // æ˜¾ç¤ºè¿›åº¦å®¹å™¨
            buildBtn.disabled = true;
            buildBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> æ„å»ºä¸­...';
            progressDiv.style.display = 'block';

            try {
                // å¼€å§‹æ„å»ºæµç¨‹
                await simulateDetailedBuildProcess(movieTitle, movieYear, maxActors, shapeType);
                
            } catch (error) {
                console.error('æ„å»ºæ•°æ®é›†å¤±è´¥:', error);
                updateStepStatus('save-database', 'error', 'æ„å»ºå¤±è´¥: ' + error.message);
                showNotification('error', 'æ„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            } finally {
                buildBtn.disabled = false;
                buildBtn.innerHTML = '<i class="bi bi-play-fill"></i> å¼€å§‹æ„å»º';
            }
        }
        
        // åˆå§‹åŒ–æ„å»ºè¿›åº¦
        function initializeBuildProgress() {
            // é‡ç½®æ‰€æœ‰æ­¥éª¤
            const steps = ['movie-info', 'color-assign', 'collect-images', 'process-faces', 'save-database'];
            steps.forEach(step => {
                const stepElement = document.getElementById(`step-${step}`);
                stepElement.className = 'step-item';
                
                const status = stepElement.querySelector('.step-status');
                status.textContent = 'ç­‰å¾…ä¸­...';
                status.className = 'step-status text-muted';
                
                // éšè—æ‰€æœ‰çŠ¶æ€å›¾æ ‡
                const icons = stepElement.querySelectorAll('.step-progress > *');
                icons.forEach(icon => icon.style.display = 'none');
                
                // éšè—å­è¿›åº¦æ¡
                const subProgress = stepElement.querySelector('.progress');
                if (subProgress) {
                    subProgress.style.display = 'none';
                    subProgress.querySelector('.progress-bar').style.width = '0%';
                }
            });
            
            // é‡ç½®æ€»ä½“è¿›åº¦
            updateOverallProgress(0, 'å‡†å¤‡æ„å»º...');
            
            // é‡ç½®ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('build-stats').style.display = 'none';
            updateBuildStats(0, 0, 0, 0);
        }
        
        // æ¨¡æ‹Ÿè¯¦ç»†çš„æ„å»ºè¿‡ç¨‹
        async function simulateDetailedBuildProcess(movieTitle, movieYear, maxActors, shapeType) {
            // æ­¥éª¤1: è·å–ç”µå½±ä¿¡æ¯
            updateStepStatus('movie-info', 'active', 'æ­£åœ¨æœç´¢ç”µå½±ä¿¡æ¯...');
            updateOverallProgress(10, 'è·å–ç”µå½±ä¿¡æ¯...');
            
            await sleep(800); // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
            
            try {
                // è¿™é‡Œå¯ä»¥å…ˆè°ƒç”¨é¢„è§ˆAPIéªŒè¯ç”µå½±ä¿¡æ¯
                const previewResponse = await fetch(`/api/movie_preview?movie=${encodeURIComponent(movieTitle)}&year=${movieYear || ''}`);
                const previewData = await previewResponse.json();
                
                if (!previewData.success) {
                    throw new Error(previewData.error || 'ç”µå½±ä¿¡æ¯è·å–å¤±è´¥');
                }
                
                updateStepStatus('movie-info', 'completed', `æ‰¾åˆ°ç”µå½±: ${previewData.data.movie_title} (${previewData.data.total_actors} ä½æ¼”å‘˜)`);
                updateBuildStats(previewData.data.total_actors, 0, 0, 0);
                
                // æ­¥éª¤2: åˆ†é…è§’è‰²é¢œè‰²
                updateStepStatus('color-assign', 'active', 'ä¸ºè§’è‰²åˆ†é…é¢œè‰²å’Œæ¡†å½¢...');
                updateOverallProgress(20, 'åˆ†é…è§’è‰²é¢œè‰²...');
                
                await sleep(500);
                updateStepStatus('color-assign', 'completed', `å·²ä¸º ${Math.min(maxActors, previewData.data.total_actors)} ä¸ªè§’è‰²åˆ†é…é¢œè‰²`);
                
                // æ­¥éª¤3: æ”¶é›†æ¼”å‘˜å›¾ç‰‡
                updateStepStatus('collect-images', 'active', 'å¼€å§‹æ”¶é›†æ¼”å‘˜å›¾ç‰‡...');
                updateOverallProgress(30, 'æ”¶é›†æ¼”å‘˜å›¾ç‰‡...');
                
                // æ¨¡æ‹Ÿå›¾ç‰‡æ”¶é›†è¿›åº¦
                await simulateImageCollection(Math.min(maxActors, previewData.data.total_actors));
                
                // æ­¥éª¤4: å¤„ç†äººè„¸æ•°æ®
                updateStepStatus('process-faces', 'active', 'å¼€å§‹å¤„ç†äººè„¸æ•°æ®...');
                updateOverallProgress(70, 'å¤„ç†äººè„¸æ•°æ®...');
                
                // æ¨¡æ‹Ÿäººè„¸å¤„ç†è¿›åº¦
                await simulateFaceProcessing();
                
                // æ­¥éª¤5: è°ƒç”¨å®é™…çš„æ„å»ºAPI
                updateStepStatus('save-database', 'active', 'ä¿å­˜åˆ°æ•°æ®åº“...');
                updateOverallProgress(90, 'ä¿å­˜åˆ°æ•°æ®åº“...');
                
                const response = await fetch('/api/build_dataset', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        movie_title: movieTitle,
                        year: movieYear ? parseInt(movieYear) : null,
                        max_actors: parseInt(maxActors),
                        shape_type: shapeType
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    updateStepStatus('save-database', 'completed', 'æ•°æ®åº“ä¿å­˜æˆåŠŸ');
                    updateOverallProgress(100, 'æ„å»ºå®Œæˆï¼');
                    
                    // æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
                    const results = data.results;
                    updateBuildStats(
                        results.actors_found || 0,
                        results.images_collected || 0,
                        results.faces_processed || 0,
                        results.embeddings_added || 0
                    );
                    
                    // æ˜¾ç¤ºæ„å»ºç»“æœ
                    displayBuildResults(results);
                    
                    // åˆ·æ–°ç›¸å…³æ•°æ®
                    setTimeout(async () => {
                        await refreshAllData();
                        showNotification('info', 'æ•°æ®å·²åŒæ­¥æ›´æ–°');
                    }, 1000);
                    
                    showNotification('success', `æ„å»ºå®Œæˆï¼å¤„ç†äº† ${results.actors_found} ä½æ¼”å‘˜ï¼Œ${results.faces_processed} å¼ äººè„¸`);
                } else {
                    throw new Error(data.error || 'æ„å»ºå¤±è´¥');
                }
                
            } catch (error) {
                throw error;
            }
        }

        // æ¨¡æ‹Ÿå›¾ç‰‡æ”¶é›†è¿‡ç¨‹
        async function simulateImageCollection(actorCount) {
            const stepElement = document.getElementById('step-collect-images');
            const subProgress = stepElement.querySelector('.progress');
            const subProgressBar = subProgress.querySelector('.progress-bar');
            
            subProgress.style.display = 'block';
            
            let collectedImages = 0;
            for (let i = 0; i < actorCount; i++) {
                const progress = (i + 1) / actorCount * 100;
                subProgressBar.style.width = `${progress}%`;
                
                const imagesPerActor = Math.floor(Math.random() * 15) + 5; // 5-20å¼ å›¾ç‰‡
                collectedImages += imagesPerActor;
                
                updateStepStatus('collect-images', 'active', `æ­£åœ¨æ”¶é›†ç¬¬ ${i + 1}/${actorCount} ä½æ¼”å‘˜çš„å›¾ç‰‡... (${collectedImages} å¼ )`);
                updateOverallProgress(30 + (progress * 0.4), `æ”¶é›†æ¼”å‘˜å›¾ç‰‡... ${Math.round(progress)}%`);
                updateBuildStats(actorCount, collectedImages, 0, 0);
                
                await sleep(200 + Math.random() * 300); // 200-500mså»¶è¿Ÿ
            }
            
            updateStepStatus('collect-images', 'completed', `å·²æ”¶é›† ${collectedImages} å¼ æ¼”å‘˜å›¾ç‰‡`);
        }
        
        // æ¨¡æ‹Ÿäººè„¸å¤„ç†è¿‡ç¨‹
        async function simulateFaceProcessing() {
            const stepElement = document.getElementById('step-process-faces');
            const subProgress = stepElement.querySelector('.progress');
            const subProgressBar = subProgress.querySelector('.progress-bar');
            
            subProgress.style.display = 'block';
            
            let processedFaces = 0;
            const totalSteps = 20;
            
            for (let i = 0; i < totalSteps; i++) {
                const progress = (i + 1) / totalSteps * 100;
                subProgressBar.style.width = `${progress}%`;
                
                const facesInBatch = Math.floor(Math.random() * 10) + 2; // 2-12å¼ äººè„¸
                processedFaces += facesInBatch;
                
                updateStepStatus('process-faces', 'active', `æ­£åœ¨å¤„ç†äººè„¸æ•°æ®... (${processedFaces} å¼ äººè„¸)`);
                updateOverallProgress(70 + (progress * 0.15), `å¤„ç†äººè„¸æ•°æ®... ${Math.round(progress)}%`);
                updateBuildStats(null, null, processedFaces, 0);
                
                await sleep(150 + Math.random() * 200); // 150-350mså»¶è¿Ÿ
            }
            
            updateStepStatus('process-faces', 'completed', `å·²å¤„ç† ${processedFaces} å¼ äººè„¸ï¼Œæå–ç‰¹å¾å‘é‡`);
        }
        
        // æ›´æ–°æ­¥éª¤çŠ¶æ€
        function updateStepStatus(stepId, status, message) {
            const stepElement = document.getElementById(`step-${stepId}`);
            const statusElement = stepElement.querySelector('.step-status');
            const spinner = stepElement.querySelector('.spinner-border');
            const successIcon = stepElement.querySelector('.bi-check-circle-fill');
            const errorIcon = stepElement.querySelector('.bi-x-circle-fill');
            
            // é‡ç½®æ‰€æœ‰å›¾æ ‡
            spinner.style.display = 'none';
            successIcon.style.display = 'none';
            errorIcon.style.display = 'none';
            
            // æ›´æ–°çŠ¶æ€
            stepElement.className = `step-item ${status}`;
            statusElement.textContent = message;
            
            switch (status) {
                case 'active':
                    spinner.style.display = 'block';
                    statusElement.className = 'step-status text-primary';
                    break;
                case 'completed':
                    successIcon.style.display = 'block';
                    statusElement.className = 'step-status text-success';
                    break;
                case 'error':
                    errorIcon.style.display = 'block';
                    statusElement.className = 'step-status text-danger';
                    break;
                default:
                    statusElement.className = 'step-status text-muted';
            }
        }
        
        // æ›´æ–°æ€»ä½“è¿›åº¦
        function updateOverallProgress(percentage, message) {
            const progressBar = document.getElementById('overall-progress-bar');
            const progressText = document.getElementById('overall-progress-text');
            
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${Math.round(percentage)}%`;
        }
        
        // æ›´æ–°æ„å»ºç»Ÿè®¡
        function updateBuildStats(actors, images, faces, vectors) {
            const statsDiv = document.getElementById('build-stats');
            
            if (actors !== null) document.getElementById('stat-actors').textContent = actors;
            if (images !== null) document.getElementById('stat-images').textContent = images;
            if (faces !== null) document.getElementById('stat-faces').textContent = faces;
            if (vectors !== null) document.getElementById('stat-vectors').textContent = vectors;
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            if (actors > 0 || images > 0 || faces > 0 || vectors > 0) {
                statsDiv.style.display = 'block';
            }
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šå»¶è¿Ÿ
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // åŠ è½½å…è´¹çˆ¬è™«çŠ¶æ€
        async function loadFreeCrawlerStatus() {
            try {
                const response = await fetch('/api/free_crawler_status');
                const data = await response.json();
                
                if (data.success) {
                    updateFreeCrawlerPreview(data.crawler_status);
                }
            } catch (error) {
                console.error('åŠ è½½å…è´¹çˆ¬è™«çŠ¶æ€å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°å…è´¹çˆ¬è™«çŠ¶æ€é¢„è§ˆ
        function updateFreeCrawlerPreview(status) {
            const previewDiv = document.getElementById('free-crawler-preview');
            
            let html = '';
            
            // æ˜¾ç¤ºå…è´¹æºçŠ¶æ€
            status.free_sources.forEach(source => {
                const badgeClass = source.enabled ? 'bg-success' : 'bg-secondary';
                const statusIcon = source.enabled ? 'âœ“' : 'âœ—';
                const displayName = source.name.replace('_images', '').replace('_', ' ');
                html += `<span class="badge ${badgeClass}">${displayName} ${statusIcon}</span>`;
            });
            
            html += `<small class="text-muted ms-2">${status.total_free_enabled} ä¸ªå…è´¹æºå·²å¯ç”¨ï¼Œæ¯ä½æ¼”å‘˜æœ€å¤š ${status.max_images_per_actor} å¼ å›¾ç‰‡</small>`;
            
            previewDiv.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå…è´¹çˆ¬è™«çŠ¶æ€è¯¦æƒ…
        async function showFreeCrawlerStatus() {
            try {
                const response = await fetch('/api/free_crawler_status');
                const data = await response.json();
                
                if (data.success) {
                    displayFreeCrawlerModal(data.crawler_status);
                } else {
                    showNotification('error', 'è·å–çˆ¬è™«çŠ¶æ€å¤±è´¥');
                }
            } catch (error) {
                console.error('è·å–çˆ¬è™«çŠ¶æ€å¤±è´¥:', error);
                showNotification('error', 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // æ˜¾ç¤ºå…è´¹çˆ¬è™«çŠ¶æ€æ¨¡æ€æ¡†
        function displayFreeCrawlerModal(status) {
            const modalHtml = `
                <div class="modal fade" id="freeCrawlerModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-download"></i> å…è´¹å›¾ç‰‡çˆ¬è™«çŠ¶æ€
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-success">
                                    <i class="bi bi-check-circle-fill"></i>
                                    <strong>å¥½æ¶ˆæ¯ï¼</strong> ${status.recommendation}
                                </div>
                                
                                <h6><i class="bi bi-gift-fill"></i> å…è´¹å›¾ç‰‡æº (${status.total_free_enabled}/${status.free_sources.length} å·²å¯ç”¨)</h6>
                                <div class="row g-3">
                                    ${status.free_sources.map(source => `
                                        <div class="col-md-6">
                                            <div class="card h-100 ${source.enabled ? 'border-success' : 'border-secondary'}">
                                                <div class="card-header d-flex justify-content-between">
                                                    <span><i class="bi bi-image"></i> ${source.name.replace('_', ' ')}</span>
                                                    <span class="badge ${source.enabled ? 'bg-success' : 'bg-secondary'}">
                                                        ${source.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}
                                                    </span>
                                                </div>
                                                <div class="card-body">
                                                    <p class="small text-muted mb-2">${source.description}</p>
                                                    <ul class="list-unstyled mb-0 small">
                                                        <li><strong>çŠ¶æ€:</strong> ${source.enabled ? 'âœ… å·¥ä½œæ­£å¸¸' : 'âŒ å·²ç¦ç”¨'}</li>
                                                        <li><strong>æœ€å¤§ç»“æœ:</strong> ${source.max_results} å¼ </li>
                                                        <li><strong>è´¹ç”¨:</strong> <span class="text-success">å®Œå…¨å…è´¹</span></li>
                                                        <li><strong>APIå¯†é’¥:</strong> <span class="text-success">æ— éœ€é…ç½®</span></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                ${status.paid_sources.length > 0 ? `
                                    <h6 class="mt-4"><i class="bi bi-credit-card"></i> ä»˜è´¹å›¾ç‰‡æº (éœ€è¦APIå¯†é’¥)</h6>
                                    <div class="row g-3">
                                        ${status.paid_sources.map(source => `
                                            <div class="col-md-6">
                                                <div class="card h-100 border-warning">
                                                    <div class="card-header d-flex justify-content-between">
                                                        <span><i class="bi bi-key"></i> ${source.name.replace('_', ' ')}</span>
                                                        <span class="badge bg-warning">éœ€è¦å¯†é’¥</span>
                                                    </div>
                                                    <div class="card-body">
                                                        <p class="small text-muted mb-2">${source.description}</p>
                                                        <ul class="list-unstyled mb-0 small">
                                                            <li><strong>çŠ¶æ€:</strong> ${source.enabled ? 'âš ï¸ éœ€è¦é…ç½®APIå¯†é’¥' : 'âŒ å·²ç¦ç”¨'}</li>
                                                            <li><strong>æœ€å¤§ç»“æœ:</strong> ${source.max_results} å¼ </li>
                                                            <li><strong>è´¹ç”¨:</strong> <span class="text-warning">éœ€è¦ä»˜è´¹API</span></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <div class="mt-4 p-3 bg-light rounded">
                                    <h6><i class="bi bi-lightbulb"></i> ä½¿ç”¨å»ºè®®</h6>
                                    <ul class="mb-0 small">
                                        <li><strong>TMDB:</strong> æä¾›å®˜æ–¹é«˜è´¨é‡æ¼”å‘˜å¤´åƒå’Œå®£ä¼ ç…§</li>
                                        <li><strong>ç™¾åº¦å›¾ç‰‡:</strong> ä½¿ç”¨"ç”µå½±å+æ¼”å‘˜å+å‰§ç…§"æœç´¢ï¼Œè·å¾—ç”µå½±ä¸­çš„å®é™…å‰§ç…§</li>
                                        <li><strong>æœç´¢ç­–ç•¥:</strong> ä¸“é—¨é’ˆå¯¹ç”µå½±å‰§ç…§ä¼˜åŒ–ï¼Œç¡®ä¿å›¾ç‰‡æ¥æºäºå®é™…ç”µå½±åœºæ™¯</li>
                                        <li><strong>è´¨é‡ä¿è¯:</strong> å‰§ç…§å›¾ç‰‡æ›´é€‚åˆäººè„¸è¯†åˆ«ï¼Œå› ä¸ºæ˜¯æ¼”å‘˜åœ¨ç”µå½±ä¸­çš„çœŸå®é€ å‹</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" onclick="optimizeFreeCrawlerConfig()">
                                    <i class="bi bi-gear"></i> ä¼˜åŒ–å…è´¹é…ç½®
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ç§»é™¤ç°æœ‰æ¨¡æ€æ¡†
            const existingModal = document.getElementById('freeCrawlerModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // æ·»åŠ æ–°æ¨¡æ€æ¡†
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            const modal = new bootstrap.Modal(document.getElementById('freeCrawlerModal'));
            modal.show();
        }
        
        // ä¼˜åŒ–å…è´¹çˆ¬è™«é…ç½®
        function optimizeFreeCrawlerConfig() {
            showNotification('success', 'å½“å‰é…ç½®å·²ä¼˜åŒ–ä¸ºæœ€ä½³å‰§ç…§æ”¶é›†ç»„åˆï¼');
            showNotification('info', 'é…ç½®è¯¦æƒ…ï¼šTMDBå®˜æ–¹å›¾ç‰‡(10å¼ ) + ç™¾åº¦å‰§ç…§æœç´¢(15å¼ )');
        }

        // æ˜¾ç¤ºæ„å»ºç»“æœ
        function displayBuildResults(results) {
            const resultsDiv = document.getElementById('build-results');
            const summaryDiv = document.getElementById('build-summary');
            
            const summaryHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6>ğŸ“½ï¸ ${results.movie_title}</h6>
                                <ul class="list-unstyled mb-0">
                                    <li>ğŸ‘¥ æ¼”å‘˜æ•°é‡: ${results.actors_found}</li>
                                    <li>ğŸ–¼ï¸ æ”¶é›†å›¾ç‰‡: ${results.images_collected}</li>
                                    <li>ğŸ˜Š å¤„ç†äººè„¸: ${results.faces_processed}</li>
                                    <li>ğŸ”¢ æ·»åŠ å‘é‡: ${results.embeddings_added}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        ${results.errors.length > 0 ? `
                            <div class="card border-warning">
                                <div class="card-body">
                                    <h6 class="text-warning">âš ï¸ æ³¨æ„äº‹é¡¹</h6>
                                    <ul class="list-unstyled mb-0 small">
                                        ${results.errors.map(error => `<li>â€¢ ${error}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        ` : `
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <h6 class="text-success">âœ… æ„å»ºæˆåŠŸ</h6>
                                    <p class="mb-0">æ•°æ®é›†å·²æˆåŠŸæ·»åŠ åˆ°å‘é‡æ•°æ®åº“</p>
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            summaryDiv.innerHTML = summaryHtml;
            resultsDiv.style.display = 'block';
        }

        // å›¾ç‰‡é¢„è§ˆ
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewDiv = document.getElementById('image-preview');
                    const previewImg = document.getElementById('preview-img');
                    previewImg.src = e.target.result;
                    previewDiv.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // äººè„¸æœç´¢
        async function searchFace() {
            const imageFile = document.getElementById('search-image').files[0];
            const topK = document.getElementById('top-k').value;
            const similarityThreshold = document.getElementById('similarity-threshold').value;

            if (!imageFile) {
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }

            const searchBtn = document.getElementById('search-btn');
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> æœç´¢ä¸­...';

            const formData = new FormData();
            formData.append('image', imageFile);
            formData.append('top_k', topK);
            formData.append('similarity_threshold', similarityThreshold);

            try {
                const response = await fetch('/api/search_face', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    displaySearchResults(data.results, data.query_face_info);
                } else {
                    alert('æœç´¢å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('äººè„¸æœç´¢å¤±è´¥:', error);
                alert('æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<i class="bi bi-search"></i> æœç´¢ç›¸ä¼¼äººè„¸';
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(results, queryFaceInfo) {
            const resultsDiv = document.getElementById('search-results');
            const containerDiv = document.getElementById('results-container');
            
            if (results.length === 0) {
                containerDiv.innerHTML = '<div class="col-12"><p class="text-muted text-center">æœªæ‰¾åˆ°ç›¸ä¼¼äººè„¸</p></div>';
            } else {
                const resultsHtml = results.map((result, index) => {
                    const metadata = result.metadata;
                    const similarity = (result.similarity * 100).toFixed(1);
                    
                    return `
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card result-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title mb-0">${metadata.actor_name || 'Unknown'}</h6>
                                        <span class="badge bg-primary similarity-badge">${similarity}%</span>
                                    </div>
                                    <div class="small text-muted">
                                        <div>ç”µå½±: ${metadata.movie_title || 'N/A'}</div>
                                        <div>æ£€æµ‹åˆ†æ•°: ${(metadata.det_score || 0).toFixed(3)}</div>
                                        <div>äººè„¸ID: ${metadata.face_id || 'N/A'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                containerDiv.innerHTML = resultsHtml;
            }
            
            resultsDiv.style.display = 'block';
        }

        // åŠ è½½æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
        async function loadDatabaseStats() {
            const statsDiv = document.getElementById('database-stats');
            
            try {
                const response = await fetch('/api/database_stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    const statsHtml = `
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="stats-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">æ•°æ®åº“å¼•æ“</h6>
                                            <span class="badge bg-info">${stats.database_type} ${stats.index_type || ''}</span>
                                        </div>
                                        <i class="bi bi-database text-muted" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stats-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">å‘é‡ç»´åº¦</h6>
                                            <span class="h5 mb-0">${stats.dimension || 512}D</span>
                                        </div>
                                        <i class="bi bi-vector-pen text-muted" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stats-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">å­˜å‚¨å‘é‡</h6>
                                            <span class="h5 mb-0">${stats.total_vectors || 0}</span>
                                        </div>
                                        <i class="bi bi-hdd text-muted" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stats-card">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">ç´¢å¼•çŠ¶æ€</h6>
                                            <span class="badge ${stats.is_trained ? 'bg-success' : 'bg-warning'}">${stats.is_trained ? 'å·²è®­ç»ƒ' : 'æœªè®­ç»ƒ'}</span>
                                        </div>
                                        <i class="bi bi-check-circle text-muted" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    statsDiv.innerHTML = statsHtml;
                    
                    // æ›´æ–°å¤´éƒ¨ç»Ÿè®¡æ•°æ®
                    document.getElementById('hero-total-vectors').textContent = stats.total_vectors || 0;
                    
                } else {
                    statsDiv.innerHTML = '<p class="text-danger">åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
                statsDiv.innerHTML = '<p class="text-danger">ç½‘ç»œé”™è¯¯</p>';
            }
        }

        // åŠ è½½æ•°æ®åº“å†…å®¹é¢„è§ˆ
        async function loadDatabaseContent() {
            const actorsPreviewDiv = document.getElementById('actors-preview');
            const moviesPreviewDiv = document.getElementById('movies-preview');
            const qualityPreviewDiv = document.getElementById('quality-preview');
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                actorsPreviewDiv.innerHTML = `
                    <div class="text-center py-4">
                        <div class="loading-spinner"></div>
                        <p class="mt-2 text-muted">åŠ è½½æ¼”å‘˜é¢„è§ˆä¸­...</p>
                    </div>
                `;
                
                const response = await fetch('/api/database_preview');
                const data = await response.json();
                
                if (data.success) {
                    console.log('æ•°æ®åº“é¢„è§ˆæ•°æ®:', data);
                    // è°ƒè¯•ä¿¡æ¯ï¼šè¾“å‡ºç”µå½±å’Œè§’è‰²ä¿¡æ¯
                    if (data.movies && data.movies.length > 0) {
                        console.log(`æ‰¾åˆ° ${data.movies.length} éƒ¨ç”µå½±`);
                        data.movies.forEach(movie => {
                            console.log(`ç”µå½±: ${movie.title}, è§’è‰²æ•°é‡: ${movie.character_count}`);
                            if (movie.characters && movie.characters.length > 0) {
                                movie.characters.forEach(character => {
                                    console.log(`  - è§’è‰²: ${character.character_name} (æ¼”å‘˜: ${character.actor_name})`);
                                });
                            }
                        });
                    } else {
                        console.log('æ•°æ®åº“ä¸ºç©ºï¼Œæ²¡æœ‰ç”µå½±æ•°æ®');
                    }
                    
                    displayMoviesPreview(data.movies || []);
                    displayMoviesStatsPreview(data.movies_stats || []);
                    displayQualityPreview(data.quality_stats || {});
                    updateDatabaseOverview(data.overview);
                } else {
                    actorsPreviewDiv.innerHTML = `
                        <div class="empty-state">
                            <i class="bi bi-database-x empty-state-icon"></i>
                            <h5>æš‚æ— æ•°æ®</h5>
                            <p>æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰ç”µå½±è§’è‰²æ•°æ®ï¼Œè¯·å…ˆæ„å»ºæ•°æ®é›†ã€‚</p>
                        </div>
                    `;
                    moviesPreviewDiv.innerHTML = '<p class="text-muted text-center">æš‚æ— æ•°æ®</p>';
                    qualityPreviewDiv.innerHTML = '<p class="text-muted text-center">æš‚æ— æ•°æ®</p>';
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®åº“å†…å®¹å¤±è´¥:', error);
                actorsPreviewDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-exclamation-triangle empty-state-icon"></i>
                        <h5>åŠ è½½å¤±è´¥</h5>
                        <p>æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚</p>
                    </div>
                `;
                moviesPreviewDiv.innerHTML = '<p class="text-danger text-center">åŠ è½½å¤±è´¥</p>';
                qualityPreviewDiv.innerHTML = '<p class="text-danger text-center">åŠ è½½å¤±è´¥</p>';
            }
        }

        // æ˜¾ç¤ºç”µå½±é¢„è§ˆï¼ˆæ–°çš„ä¸»æ˜¾ç¤ºåŒºåŸŸï¼‰
        function displayMoviesPreview(movies) {
            const actorsPreviewDiv = document.getElementById('actors-preview');
            
            if (!movies || movies.length === 0) {
                actorsPreviewDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-film-x empty-state-icon"></i>
                        <h5>æš‚æ— ç”µå½±æ•°æ®</h5>
                        <p>è¯·å…ˆæ„å»ºä¸€äº›ç”µå½±çš„è§’è‰²æ•°æ®é›†ã€‚</p>
                    </div>
                `;
                return;
            }
            
            const moviesHtml = `
                <div class="row g-3">
                    ${movies.slice(0, 6).map(movie => {
                        const charactersHtml = movie.characters ? movie.characters.slice(0, 6).map(character => {
                            const avatarHtml = character.avatar_path ? 
                                `<img src="/api/image/${encodeURIComponent(character.avatar_path)}" class="character-img" alt="${character.actor_name}" onerror="this.outerHTML='&lt;div class=&quot;character-placeholder&quot;&gt;&lt;i class=&quot;bi bi-person-fill&quot;&gt;&lt;/i&gt;&lt;/div&gt;';">` :
                                `<div class="character-placeholder"><i class="bi bi-person-fill"></i></div>`;
                            
                            return `
                                <div class="character-item">
                                    <div class="character-avatar">${avatarHtml}</div>
                                    <div class="character-info">
                                        <div class="character-name">${character.character_name || 'Unknown'}</div>
                                        <div class="actor-name">${character.actor_name || 'Unknown Actor'}</div>
                                        <div class="character-stats">
                                            <span class="face-count">${character.face_count || 0} äººè„¸</span>
                                            <span class="quality-score">${character.avg_quality ? (character.avg_quality * 100).toFixed(0) : 0}%</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('') : '';
                        
                        const moreCharacters = movie.characters && movie.characters.length > 6 ? `
                            <div class="character-item more-characters">
                                <div class="character-placeholder"><i class="bi bi-three-dots"></i></div>
                                <div class="character-info">
                                    <div class="character-name">+${movie.characters.length - 6} æ›´å¤š</div>
                                </div>
                            </div>
                        ` : '';
                        
                        return `
                            <div class="col-lg-6 col-md-12">
                                <div class="movie-preview-card fade-in">
                                    <div class="movie-header d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="movie-title mb-0">
                                            <i class="bi bi-film me-2"></i>${movie.title || 'Unknown Movie'}
                                        </h6>
                                        <div class="movie-stats">
                                            <span class="badge bg-primary me-1">${movie.character_count || 0} è§’è‰²</span>
                                            <span class="badge bg-info">${movie.total_faces || 0} äººè„¸</span>
                                        </div>
                                    </div>
                                    <div class="characters-grid">
                                        ${charactersHtml}${moreCharacters}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                ${movies.length > 6 ? `
                    <div class="text-center mt-3">
                        <button class="btn btn-outline-primary btn-sm" onclick="loadFullMoviesInPlace()">
                            <i class="bi bi-plus-circle"></i> æŸ¥çœ‹æ›´å¤š (${movies.length - 6} éƒ¨ç”µå½±)
                        </button>
                    </div>
                ` : ''}
            `;
            
            actorsPreviewDiv.innerHTML = moviesHtml;
        }

        // æ˜¾ç¤ºç”µå½±ç»Ÿè®¡é¢„è§ˆï¼ˆå³ä¾§çš„ç”µå½±åˆ†å¸ƒåŒºåŸŸï¼‰
        function displayMoviesStatsPreview(moviesStats) {
            const moviesPreviewDiv = document.getElementById('movies-preview');
            
            if (!moviesStats || moviesStats.length === 0) {
                moviesPreviewDiv.innerHTML = '<p class="text-muted text-center">æš‚æ— ç”µå½±æ•°æ®</p>';
                return;
            }
            
            const moviesHtml = moviesStats.slice(0, 5).map(movie => `
                <div class="movie-tag">
                    ${movie.name} (${movie.character_count}ä¸ªè§’è‰²)
                </div>
            `).join('');
            
            moviesPreviewDiv.innerHTML = moviesHtml;
            
            if (moviesStats.length > 5) {
                moviesPreviewDiv.innerHTML += `<div class="movie-tag">+${moviesStats.length - 5} æ›´å¤š...</div>`;
            }
        }

        // æ˜¾ç¤ºè´¨é‡åˆ†å¸ƒé¢„è§ˆ
        function displayQualityPreview(qualityStats) {
            const qualityPreviewDiv = document.getElementById('quality-preview');
            
            if (!qualityStats || Object.keys(qualityStats).length === 0) {
                qualityPreviewDiv.innerHTML = '<p class="text-muted text-center">æš‚æ— è´¨é‡æ•°æ®</p>';
                return;
            }
            
            const qualities = [
                { label: 'é«˜è´¨é‡ (80%+)', value: qualityStats.high || 0, color: '#10b981' },
                { label: 'ä¸­ç­‰è´¨é‡ (60-80%)', value: qualityStats.medium || 0, color: '#f59e0b' },
                { label: 'ä½è´¨é‡ (<60%)', value: qualityStats.low || 0, color: '#ef4444' }
            ];
            
            const total = qualities.reduce((sum, q) => sum + q.value, 0);
            
            const qualityHtml = qualities.map(quality => {
                const percentage = total > 0 ? (quality.value / total * 100) : 0;
                return `
                    <div class="quality-bar">
                        <div class="quality-fill" style="width: ${percentage}%; background: ${quality.color};"></div>
                        <div class="quality-label">${quality.label}: ${quality.value}</div>
                    </div>
                `;
            }).join('');
            
            qualityPreviewDiv.innerHTML = qualityHtml;
        }

        // æ›´æ–°æ•°æ®åº“æ¦‚è§ˆ
        function updateDatabaseOverview(overview) {
            if (overview) {
                document.getElementById('db-total-movies').textContent = overview.total_movies || 0;
                document.getElementById('db-total-characters').textContent = overview.total_characters || 0;
                document.getElementById('db-total-faces').textContent = overview.total_faces || 0;
                document.getElementById('db-avg-quality').textContent = overview.avg_quality ? (overview.avg_quality * 100).toFixed(1) + '%' : '-';
                
                // æ›´æ–°å¤´éƒ¨ç»Ÿè®¡
                document.getElementById('hero-total-actors').textContent = overview.total_characters || 0;  // æ”¹ä¸ºæ˜¾ç¤ºè§’è‰²æ•°
                document.getElementById('hero-total-vectors').textContent = overview.total_faces || 0;
                document.getElementById('hero-total-movies').textContent = overview.total_movies || 0;
            }
        }


        // æ˜¾ç¤ºæ‰€æœ‰ç”µå½±åœ¨å½“å‰ä½ç½®
        function displayAllMoviesInPlace(movies) {
            const actorsPreviewDiv = document.getElementById('actors-preview');
            
            if (!movies || movies.length === 0) {
                actorsPreviewDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-film-x empty-state-icon"></i>
                        <h5>æš‚æ— ç”µå½±æ•°æ®</h5>
                        <p>è¯·å…ˆæ„å»ºä¸€äº›ç”µå½±çš„è§’è‰²æ•°æ®é›†ã€‚</p>
                    </div>
                `;
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰ç”µå½±ï¼ˆä¸é™åˆ¶æ•°é‡ï¼‰
            const moviesHtml = `
                <div class="row g-3">
                    ${movies.map(movie => {
                        const charactersHtml = movie.characters ? movie.characters.map(character => {
                            const avatarHtml = character.avatar_path ? 
                                `<img src="/api/image/${encodeURIComponent(character.avatar_path)}" class="character-img" alt="${character.actor_name}" onerror="this.outerHTML='&lt;div class=&quot;character-placeholder&quot;&gt;&lt;i class=&quot;bi bi-person-fill&quot;&gt;&lt;/i&gt;&lt;/div&gt;';">` :
                                `<div class="character-placeholder"><i class="bi bi-person-fill"></i></div>`;
                            
                            return `
                                <div class="character-item">
                                    <div class="character-avatar">${avatarHtml}</div>
                                    <div class="character-info">
                                        <div class="character-name">${character.character_name || 'Unknown'}</div>
                                        <div class="actor-name">${character.actor_name || 'Unknown Actor'}</div>
                                        <div class="character-stats">
                                            <span class="face-count">${character.face_count || 0} äººè„¸</span>
                                            <span class="quality-score">${character.avg_quality ? (character.avg_quality * 100).toFixed(0) : 0}%</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('') : '';
                        
                        return `
                            <div class="col-lg-6 col-md-12">
                                <div class="movie-preview-card fade-in">
                                    <div class="movie-header d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="movie-title mb-0">
                                            <i class="bi bi-film me-2"></i>${movie.title || 'Unknown Movie'}
                                        </h6>
                                        <div class="movie-stats">
                                            <span class="badge bg-primary me-1">${movie.character_count || 0} è§’è‰²</span>
                                            <span class="badge bg-info">${movie.total_faces || 0} äººè„¸</span>
                                        </div>
                                    </div>
                                    <div class="characters-grid">
                                        ${charactersHtml}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            actorsPreviewDiv.innerHTML = moviesHtml;
        }

        // æŸ¥çœ‹å…¨éƒ¨æ•°æ®
        function viewAllActors() {
            // ç›´æ¥åœ¨å½“å‰é¡µé¢å±•å¼€æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
            loadFullMoviesInPlace();
        }

        // è°ƒè¯•metadata
        async function debugMetadata() {
            try {
                const response = await fetch('/api/debug/metadata');
                const data = await response.json();
                
                if (data.success) {
                    console.log('=== è°ƒè¯•ä¿¡æ¯ ===');
                    console.log('æ•°æ®åº“ç»Ÿè®¡:', data.stats);
                    console.log('å­—æ®µç»Ÿè®¡:', data.field_stats);
                    console.log('Metadataæ ·æœ¬:', data.metadata_sample);
                    console.log('æ‰€æœ‰Metadata:', data.all_metadata);
                    
                    // æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
                    const debugInfo = `
                        <div class="alert alert-info">
                            <h6>è°ƒè¯•ä¿¡æ¯ï¼š</h6>
                            <p><strong>æ•°æ®åº“ç»Ÿè®¡:</strong> ${JSON.stringify(data.stats, null, 2)}</p>
                            <p><strong>å­—æ®µç»Ÿè®¡:</strong> ${JSON.stringify(data.field_stats, null, 2)}</p>
                            <p><strong>Metadataæ•°é‡:</strong> ${data.metadata_count}</p>
                            <details>
                                <summary>æŸ¥çœ‹Metadataæ ·æœ¬</summary>
                                <pre>${JSON.stringify(data.metadata_sample, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                    
                    const actorsPreviewDiv = document.getElementById('actors-preview');
                    actorsPreviewDiv.innerHTML = debugInfo;
                    
                    showNotification('info', 'è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°å’Œé¡µé¢');
                } else {
                    console.error('è°ƒè¯•å¤±è´¥:', data.error);
                    showNotification('error', 'è°ƒè¯•å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('è°ƒè¯•è¯·æ±‚å¤±è´¥:', error);
                showNotification('error', 'è°ƒè¯•è¯·æ±‚å¤±è´¥');
            }
        }

        // åœ¨å½“å‰é¡µé¢åŠ è½½å®Œæ•´æ•°æ®åˆ—è¡¨
        async function loadFullMoviesInPlace() {
            const actorsPreviewDiv = document.getElementById('actors-preview');
            const viewAllBtn = document.getElementById('view-all-btn');
            
            if (!viewAllBtn) {
                console.error('æŸ¥çœ‹å…¨éƒ¨æŒ‰é’®æœªæ‰¾åˆ°');
                return;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const originalText = viewAllBtn.innerHTML;
            viewAllBtn.disabled = true;
            viewAllBtn.innerHTML = '<div class="loading-spinner"></div> åŠ è½½ä¸­...';
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                actorsPreviewDiv.innerHTML = `
                    <div class="text-center py-4">
                        <div class="loading-spinner"></div>
                        <p class="mt-2 text-muted">åŠ è½½æ‰€æœ‰æ•°æ®ä¸­...</p>
                    </div>
                `;
                
                const response = await fetch('/api/database_content');
                const data = await response.json();
                
                console.log('æŸ¥çœ‹å…¨éƒ¨ - APIå“åº”:', data);
                
                if (data.success) {
                    // ä¼˜å…ˆæ˜¾ç¤ºç”µå½±æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºæ¼”å‘˜æ•°æ®
                    if (data.movies && data.movies.length > 0) {
                        console.log('æ˜¾ç¤ºç”µå½±æ•°æ®ï¼Œæ•°é‡:', data.movies.length);
                        displayAllMoviesInPlace(data.movies);
                    } else if (data.recent_actors && data.recent_actors.length > 0) {
                        console.log('æ˜¾ç¤ºæ¼”å‘˜æ•°æ®ï¼Œæ•°é‡:', data.recent_actors.length);
                    displayAllActorsInPlace(data.recent_actors);
                    } else {
                        actorsPreviewDiv.innerHTML = `
                            <div class="empty-state">
                                <i class="bi bi-database-x empty-state-icon"></i>
                                <h5>æš‚æ— æ•°æ®</h5>
                                <p>æ•°æ®åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ•°æ®</p>
                            </div>
                        `;
                    }
                    
                    // æ›´æ–°æŒ‰é’®ä¸º"æ”¶èµ·"
                    viewAllBtn.innerHTML = '<i class="bi bi-chevron-up"></i> æ”¶èµ·';
                    viewAllBtn.onclick = function() { 
                        loadDatabaseContent(); 
                        viewAllBtn.innerHTML = '<i class="bi bi-grid-3x3-gap-fill"></i> æŸ¥çœ‹å…¨éƒ¨';
                        viewAllBtn.onclick = function() { loadFullMoviesInPlace(); };
                    };
                    
                } else {
                    actorsPreviewDiv.innerHTML = `
                        <div class="empty-state">
                            <i class="bi bi-database-x empty-state-icon"></i>
                            <h5>æš‚æ— æ•°æ®</h5>
                            <p>æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰ç”µå½±è§’è‰²æ•°æ®ï¼Œè¯·å…ˆæ„å»ºæ•°æ®é›†ã€‚</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½æ‰€æœ‰æ¼”å‘˜å¤±è´¥:', error);
                actorsPreviewDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-exclamation-triangle empty-state-icon"></i>
                        <h5>åŠ è½½å¤±è´¥</h5>
                        <p>æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚</p>
                    </div>
                `;
            } finally {
                viewAllBtn.disabled = false;
                if (viewAllBtn.innerHTML.includes('åŠ è½½ä¸­')) {
                    viewAllBtn.innerHTML = originalText;
                }
            }
        }

        // åœ¨å½“å‰é¡µé¢æ˜¾ç¤ºæ‰€æœ‰æ¼”å‘˜
        function displayAllActorsInPlace(actors) {
            const actorsPreviewDiv = document.getElementById('actors-preview');
            
            if (!actors || actors.length === 0) {
                actorsPreviewDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-person-x empty-state-icon"></i>
                        <h5>æš‚æ— æ¼”å‘˜æ•°æ®</h5>
                        <p>è¯·å…ˆæ„å»ºä¸€äº›ç”µå½±çš„æ¼”å‘˜æ•°æ®é›†ã€‚</p>
                    </div>
                `;
                return;
            }
            
            const actorsHtml = `
                <div class="row g-3">
                    ${actors.map(actor => `
                        <div class="col-md-2 col-sm-4 col-6">
                            <div class="actor-preview-card fade-in position-relative">
                                <button class="btn btn-outline-danger btn-sm position-absolute top-0 end-0 m-2" 
                                        onclick="deleteActor('${actor.name}')" 
                                        title="åˆ é™¤æ¼”å‘˜"
                                        style="z-index: 10;">
                                    <i class="bi bi-trash"></i>
                                </button>
                                ${actor.avatar_path ? 
                                    `<img src="/api/image/${encodeURIComponent(actor.avatar_path)}" class="actor-preview-avatar" alt="${actor.name}" 
                                          onerror="this.outerHTML='<div class=&quot;actor-preview-avatar d-flex align-items-center justify-content-center bg-light mx-auto&quot;><i class=&quot;bi bi-person-fill text-muted&quot;></i></div>';">` :
                                    `<div class="actor-preview-avatar d-flex align-items-center justify-content-center bg-light mx-auto">
                                        <i class="bi bi-person-fill text-muted"></i>
                                    </div>`
                                }
                                <h6 class="mb-1 text-truncate" title="${actor.name}">${actor.name}</h6>
                                <small class="text-muted d-block">${(actor.movies && actor.movies.length > 0) ? actor.movies[0] : 'æœªçŸ¥ç”µå½±'}</small>
                                <div class="mt-2">
                                    <span class="badge bg-primary">${actor.face_count || 0}</span>
                                    <span class="badge bg-success ms-1">${actor.avg_quality ? (actor.avg_quality * 100).toFixed(0) : 0}%</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            actorsPreviewDiv.innerHTML = actorsHtml;
        }


        // æŸ¥çœ‹æ¼”å‘˜è¯¦æƒ…
        function viewActorDetails(actorId) {
            alert('æ¼”å‘˜è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // æœç´¢ç›¸ä¼¼æ¼”å‘˜
        function searchSimilarActor(actorId) {
            alert('ç›¸ä¼¼æ¼”å‘˜æœç´¢åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // åˆ é™¤æ¼”å‘˜
        async function deleteActor(actorName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ¼”å‘˜"${actorName}"çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤è¯¥æ¼”å‘˜çš„æ‰€æœ‰äººè„¸å‘é‡å’Œå›¾ç‰‡æ•°æ®ï¼Œæ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/delete_actor/${encodeURIComponent(actorName)}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showNotification('success', data.message || `æ¼”å‘˜"${actorName}"å·²åˆ é™¤`);
                    
                    // é‡æ–°åŠ è½½æ•°æ®
                    setTimeout(() => {
                        refreshAllData();
                    }, 500);
                } else {
                    showNotification('error', 'åˆ é™¤å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('åˆ é™¤æ¼”å‘˜å¤±è´¥:', error);
                showNotification('error', 'åˆ é™¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // æ¸…ç©ºæ•°æ®åº“
        async function clearDatabase() {
            if (!confirm('âš ï¸ å±é™©æ“ä½œè­¦å‘Šï¼\n\nç¡®å®šè¦æ¸…ç©ºæ•´ä¸ªæ•°æ®åº“å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰æ¼”å‘˜æ•°æ®ã€äººè„¸å‘é‡å’Œå›¾ç‰‡ï¼Œæ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            // äºŒæ¬¡ç¡®è®¤
            if (!confirm('è¯·å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦æ¸…ç©ºæ•´ä¸ªæ•°æ®åº“å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch('/api/clear_database', {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('success', 'æ•°æ®åº“å·²æ¸…ç©º');
                    
                    // é‡æ–°åŠ è½½æ•°æ®
                    setTimeout(() => {
                        refreshAllData();
                    }, 500);
                } else {
                    showNotification('error', 'æ¸…ç©ºå¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('æ¸…ç©ºæ•°æ®åº“å¤±è´¥:', error);
                showNotification('error', 'æ¸…ç©ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // å¯¼å‡ºmetadataæ–‡ä»¶
        async function exportMetadata() {
            try {
                showNotification('info', 'æ­£åœ¨å‡†å¤‡å¯¼å‡ºmetadataæ–‡ä»¶...');
                
                const response = await fetch('/api/export_metadata');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const exportData = result.data;
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                        type: 'application/json'
                    });
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `metadata_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('success', `Metadataæ–‡ä»¶å·²å¯¼å‡º (${exportData.total_records}æ¡è®°å½•)`);
                } else {
                    showNotification('error', 'å¯¼å‡ºå¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('å¯¼å‡ºmetadataå¤±è´¥:', error);
                showNotification('error', 'å¯¼å‡ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // é¢„è§ˆç”µå½±æ¼”å‘˜
        async function previewMovieActors() {
            const movieTitle = document.getElementById('movie-title').value.trim();
            const movieYear = document.getElementById('movie-year').value.trim();
            const previewBtn = document.getElementById('preview-actors-btn');
            
            if (!movieTitle) {
                showNotification('warning', 'è¯·å…ˆè¾“å…¥ç”µå½±åç§°');
                return;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const originalText = previewBtn.innerHTML;
            previewBtn.disabled = true;
            previewBtn.innerHTML = '<div class="loading-spinner"></div> åŠ è½½ä¸­...';
            
            try {
                const params = new URLSearchParams({
                    movie: movieTitle
                });
                if (movieYear) {
                    params.append('year', movieYear);
                }
                
                const response = await fetch(`/api/movie_preview?${params}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayActorsPreview(result.data);
                    showNotification('success', `æˆåŠŸè·å– ${result.data.total_actors} ä½æ¼”å‘˜ä¿¡æ¯`);
                } else {
                    showNotification('error', result.error || 'è·å–æ¼”å‘˜ä¿¡æ¯å¤±è´¥');
                }
                
            } catch (error) {
                console.error('é¢„è§ˆæ¼”å‘˜å¤±è´¥:', error);
                showNotification('error', 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
            } finally {
                previewBtn.disabled = false;
                previewBtn.innerHTML = originalText;
            }
        }
        
        // æ˜¾ç¤ºæ¼”å‘˜é¢„è§ˆ
        function displayActorsPreview(data) {
            const previewSection = document.getElementById('actors-preview-section');
            const previewContent = document.getElementById('actors-preview-content');
            const actorCountBadge = document.getElementById('preview-actor-count');
            
            // æ›´æ–°æ¼”å‘˜æ•°é‡
            actorCountBadge.textContent = data.total_actors;
            
            // æ„å»ºæ¼”å‘˜åˆ—è¡¨HTML
            const actorsHtml = `
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">ç”µå½±: <strong>${data.movie_title}</strong> ${data.year ? `(${data.year})` : ''}</span>
                        <div>
                            <button class="btn btn-success btn-sm" onclick="selectTopActors(10)">é€‰æ‹©å‰10ä½</button>
                            <button class="btn btn-primary btn-sm" onclick="selectTopActors(20)">é€‰æ‹©å‰20ä½</button>
                            <button class="btn btn-secondary btn-sm" onclick="selectAllActors()">å…¨é€‰</button>
                        </div>
                    </div>
                </div>
                <div class="row g-2" style="max-height: 400px; overflow-y: auto;">
                    ${data.actors.map((actor, index) => `
                        <div class="col-md-3 col-sm-4 col-6">
                            <div class="card actor-preview-card h-100" data-actor-index="${index}">
                                <div class="card-body p-2">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input actor-checkbox" type="checkbox" 
                                               id="actor-${index}">
                                        <label class="form-check-label fw-bold" for="actor-${index}">
                                            ${actor.name}
                                        </label>
                                    </div>
                                    <small class="text-muted d-block mb-1">è§’è‰²: ${actor.character}</small>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="badge bg-light text-dark">æ’åº: ${actor.order}</small>
                                        <small class="text-muted">çƒ­åº¦: ${actor.popularity.toFixed(1)}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        ğŸ’¡ æç¤º: æ¼”å‘˜æŒ‰é‡è¦ç¨‹åº¦æ’åºï¼Œå»ºè®®é€‰æ‹©å‰10-20ä½ä¸»è¦æ¼”å‘˜è¿›è¡Œæ•°æ®é›†æ„å»º
                    </small>
                </div>
            `;
            
            previewContent.innerHTML = actorsHtml;
            previewSection.style.display = 'block';
            
            // æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
            previewSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // é€‰æ‹©å‰Nä½æ¼”å‘˜
        function selectTopActors(count) {
            const checkboxes = document.querySelectorAll('.actor-checkbox');
            checkboxes.forEach((checkbox, index) => {
                checkbox.checked = index < count;
            });
            updateSelectedActorCount();
        }
        
        // å…¨é€‰æ¼”å‘˜
        function selectAllActors() {
            const checkboxes = document.querySelectorAll('.actor-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedActorCount();
        }
        
        // æ›´æ–°é€‰ä¸­çš„æ¼”å‘˜æ•°é‡
        function updateSelectedActorCount() {
            const selectedCount = document.querySelectorAll('.actor-checkbox:checked').length;
            const maxActorsInput = document.getElementById('max-actors');
            maxActorsInput.value = selectedCount;
            
            // æ›´æ–°æ˜¾ç¤º
            showNotification('info', `å·²é€‰æ‹© ${selectedCount} ä½æ¼”å‘˜`);
        }
        
        // éšè—æ¼”å‘˜é¢„è§ˆ
        function hideActorsPreview() {
            const previewSection = document.getElementById('actors-preview-section');
            previewSection.style.display = 'none';
        }
        
        // æ™ºèƒ½æ¨èæ¼”å‘˜æ•°é‡
        function smartRecommendActorCount() {
            const previewSection = document.getElementById('actors-preview-section');
            
            if (previewSection.style.display === 'none') {
                showNotification('info', 'è¯·å…ˆé¢„è§ˆæ¼”å‘˜ä¿¡æ¯ï¼Œç„¶åç³»ç»Ÿä¼šæ™ºèƒ½æ¨èæ¼”å‘˜æ•°é‡');
                return;
            }
            
            const totalActors = document.querySelectorAll('.actor-checkbox').length;
            let recommendedCount;
            
            if (totalActors <= 10) {
                recommendedCount = totalActors;
            } else if (totalActors <= 30) {
                recommendedCount = Math.min(15, totalActors);
            } else {
                recommendedCount = 20;
            }
            
            selectTopActors(recommendedCount);
            showNotification('success', `æ™ºèƒ½æ¨è: é€‰æ‹©å‰ ${recommendedCount} ä½ä¸»è¦æ¼”å‘˜`);
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(type, message) {
            // ç§»é™¤ç°æœ‰çš„é€šçŸ¥
            const existingNotifications = document.querySelectorAll('.toast-notification');
            existingNotifications.forEach(n => n.remove());
            
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            const alertType = type === 'success' ? 'success' : 
                            type === 'error' ? 'danger' : 
                            type === 'warning' ? 'warning' : 'info';
            
            notification.className = `alert alert-${alertType} alert-dismissible fade show position-fixed toast-notification`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 400px;';
            
            const icon = type === 'success' ? 'check-circle-fill' : 
                        type === 'error' ? 'exclamation-triangle-fill' : 
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle-fill';
            
            notification.innerHTML = `
                <i class="bi bi-${icon} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // è‡ªåŠ¨ç§»é™¤æ—¶é—´æ ¹æ®æ¶ˆæ¯ç±»å‹è°ƒæ•´
            const autoRemoveTime = type === 'error' ? 5000 : 3000;
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, autoRemoveTime);
        }

        // è§†é¢‘è¯†åˆ«ç›¸å…³å‡½æ•°
        
        // åŠ è½½å¯è¯†åˆ«çš„æ¼”å‘˜åˆ—è¡¨
        async function loadVideoActors() {
            try {
                const response = await fetch('/api/video_actors');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('recognizable-count').textContent = data.total_count || 0;
                    
                    // æ˜¾ç¤ºæ¼”å‘˜åˆ—è¡¨ï¼ˆå¯ä»¥æ·»åŠ æ¨¡æ€æ¡†æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼‰
                    console.log('å¯è¯†åˆ«æ¼”å‘˜:', data.actors);
                } else {
                    document.getElementById('recognizable-count').textContent = '0';
                }
            } catch (error) {
                console.error('åŠ è½½æ¼”å‘˜åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('recognizable-count').textContent = '?';
            }
        }

        // æ›´æ–°é˜ˆå€¼æ˜¾ç¤º
        function updateThresholdValue() {
            const threshold = document.getElementById('similarity-threshold').value;
            document.getElementById('threshold-value').textContent = threshold;
        }

        // æ–‡ä»¶ç±»å‹æ£€æŸ¥ï¼ˆä¸å†é¢„è§ˆè§†é¢‘å¸§ï¼‰
        function checkFileType(event) {
            const file = event.target.files[0];
            if (!file) {
                hideVideoPreview();
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const fileType = file.type;
            const isVideo = fileType.startsWith('video/');
            const isImage = fileType.startsWith('image/');
            
            if (isVideo) {
                // åªæ˜¾ç¤ºè§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼Œä¸é¢„è§ˆç¬¬ä¸€å¸§
                showVideoFileInfo(file);
            } else if (isImage) {
                processImagePreview(file);
            } else {
                hideVideoPreview();
                showNotification('error', 'ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·ä¸Šä¼ å›¾ç‰‡æˆ–è§†é¢‘æ–‡ä»¶');
            }
        }
        
        // æ˜¾ç¤ºè§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼ˆä¸é¢„è§ˆç¬¬ä¸€å¸§ï¼‰
        function showVideoFileInfo(file) {
            const previewDiv = document.getElementById('original-preview');
            const previewImg = document.getElementById('original-img');
            
            // éšè—å›¾ç‰‡é¢„è§ˆ
            previewImg.style.display = 'none';
            
            // æ˜¾ç¤ºè§†é¢‘æ–‡ä»¶ä¿¡æ¯
            const video = document.createElement('video');
            video.preload = 'metadata';
            video.muted = true;
            
            const objectURL = URL.createObjectURL(file);
            video.src = objectURL;
            
            video.addEventListener('loadedmetadata', function() {
                // åªæ˜¾ç¤ºè§†é¢‘ä¿¡æ¯ï¼Œä¸æ˜¾ç¤ºé¢„è§ˆå›¾
                updateVideoInfo(video, file);
                showVideoPreviewSuccess(previewDiv, 'è§†é¢‘æ–‡ä»¶å·²é€‰æ‹©');
                
                // é‡Šæ”¾èµ„æº
                URL.revokeObjectURL(objectURL);
            });
            
            video.addEventListener('error', function() {
                showVideoPreviewError('è§†é¢‘æ–‡ä»¶ä¿¡æ¯è¯»å–å¤±è´¥');
                URL.revokeObjectURL(objectURL);
            });
        }
        
        // å¤„ç†å›¾ç‰‡é¢„è§ˆ
        function processImagePreview(file) {
            const previewDiv = document.getElementById('original-preview');
            const previewImg = document.getElementById('original-img');
            
            // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
            previewImg.style.display = 'block';
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                
                // è·å–å›¾ç‰‡ä¿¡æ¯
                const img = new Image();
                img.onload = function() {
                    updateImageInfo(img, file);
                    showVideoPreviewSuccess(previewDiv, 'åŸå§‹å›¾ç‰‡');
                };
                img.src = e.target.result;
            };
            
            reader.onerror = function() {
                showVideoPreviewError('å›¾ç‰‡åŠ è½½å¤±è´¥');
            };
            
            reader.readAsDataURL(file);
        }
        
        // æ˜¾ç¤ºé¢„è§ˆåŠ è½½çŠ¶æ€
        function showVideoPreviewLoading() {
            const previewDiv = document.getElementById('original-preview');
            const previewImg = document.getElementById('original-img');
            
            previewDiv.style.display = 'block';
            previewDiv.className = 'preview-container loading';
            
            // åˆ›å»ºåŠ è½½æç¤º
            previewImg.style.display = 'none';
            let loadingDiv = previewDiv.querySelector('.loading-overlay');
            if (!loadingDiv) {
                loadingDiv = document.createElement('div');
                loadingDiv.className = 'loading-overlay';
                loadingDiv.innerHTML = `
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">æ­£åœ¨åŠ è½½é¢„è§ˆ...</div>
                    </div>
                `;
                previewDiv.appendChild(loadingDiv);
            }
            loadingDiv.style.display = 'flex';
        }
        
        // æ˜¾ç¤ºé¢„è§ˆæˆåŠŸ
        function showVideoPreviewSuccess(previewDiv, title) {
            previewDiv.className = 'preview-container success';
            previewDiv.querySelector('h6').textContent = title;
            
            const previewImg = document.getElementById('original-img');
            previewImg.style.display = 'block';
            
            const loadingDiv = previewDiv.querySelector('.loading-overlay');
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
            
            // æ·»åŠ æˆåŠŸåŠ¨ç”»
            previewImg.style.opacity = '0';
            previewImg.style.transform = 'scale(0.95)';
            setTimeout(() => {
                previewImg.style.transition = 'all 0.3s ease';
                previewImg.style.opacity = '1';
                previewImg.style.transform = 'scale(1)';
            }, 100);
        }
        
        // æ˜¾ç¤ºé¢„è§ˆé”™è¯¯
        function showVideoPreviewError(message) {
            const previewDiv = document.getElementById('original-preview');
            previewDiv.className = 'preview-container error';
            previewDiv.style.display = 'block';
            
            const previewImg = document.getElementById('original-img');
            previewImg.style.display = 'none';
            
            let loadingDiv = previewDiv.querySelector('.loading-overlay');
            if (!loadingDiv) {
                loadingDiv = document.createElement('div');
                loadingDiv.className = 'loading-overlay';
                previewDiv.appendChild(loadingDiv);
            }
            
            loadingDiv.innerHTML = `
                <div class="error-content">
                    <i class="bi bi-exclamation-triangle text-warning" style="font-size: 2rem;"></i>
                    <div class="error-text">${message}</div>
                </div>
            `;
            loadingDiv.style.display = 'flex';
        }
        
        // éšè—é¢„è§ˆ
        function hideVideoPreview() {
            const previewDiv = document.getElementById('original-preview');
            previewDiv.style.display = 'none';
            previewDiv.className = 'preview-container';
            
            const previewImg = document.getElementById('original-img');
            previewImg.src = '';
            
            const loadingDiv = previewDiv.querySelector('.loading-overlay');
            if (loadingDiv) {
                loadingDiv.remove();
            }
            
            // æ¸…ç†ä¿¡æ¯æ˜¾ç¤º
            const infoDiv = document.getElementById('file-info');
            if (infoDiv) {
                infoDiv.style.display = 'none';
            }
        }
        
        // æ›´æ–°è§†é¢‘ä¿¡æ¯æ˜¾ç¤º
        function updateVideoInfo(video, file) {
            const infoDiv = document.getElementById('file-info') || createFileInfoDiv();
            
            const duration = formatDuration(video.duration);
            const size = formatFileSize(file.size);
            const resolution = `${video.videoWidth}Ã—${video.videoHeight}`;
            
            infoDiv.innerHTML = `
                <div class="file-info-grid">
                    <div class="info-item">
                        <i class="bi bi-camera-video"></i>
                        <span>è§†é¢‘æ–‡ä»¶</span>
                    </div>
                    <div class="info-item">
                        <i class="bi bi-clock"></i>
                        <span>${duration}</span>
                    </div>
                    <div class="info-item">
                        <i class="bi bi-aspect-ratio"></i>
                        <span>${resolution}</span>
                    </div>
                    <div class="info-item">
                        <i class="bi bi-file-earmark"></i>
                        <span>${size}</span>
                    </div>
                </div>
            `;
            infoDiv.style.display = 'block';
        }
        
        // æ›´æ–°å›¾ç‰‡ä¿¡æ¯æ˜¾ç¤º
        function updateImageInfo(img, file) {
            const infoDiv = document.getElementById('file-info') || createFileInfoDiv();
            
            const size = formatFileSize(file.size);
            const resolution = `${img.naturalWidth}Ã—${img.naturalHeight}`;
            
            infoDiv.innerHTML = `
                <div class="file-info-grid">
                    <div class="info-item">
                        <i class="bi bi-image"></i>
                        <span>å›¾ç‰‡æ–‡ä»¶</span>
                    </div>
                    <div class="info-item">
                        <i class="bi bi-aspect-ratio"></i>
                        <span>${resolution}</span>
                    </div>
                    <div class="info-item">
                        <i class="bi bi-file-earmark"></i>
                        <span>${size}</span>
                    </div>
                </div>
            `;
            infoDiv.style.display = 'block';
        }
        
        // åˆ›å»ºæ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ
        function createFileInfoDiv() {
            let infoDiv = document.getElementById('file-info');
            if (!infoDiv) {
                infoDiv = document.createElement('div');
                infoDiv.id = 'file-info';
                infoDiv.className = 'file-info mt-2';
                
                const previewDiv = document.getElementById('original-preview');
                previewDiv.parentNode.insertBefore(infoDiv, previewDiv.nextSibling);
            }
            return infoDiv;
        }
        
        // æ ¼å¼åŒ–æ—¶é•¿
        function formatDuration(seconds) {
            if (isNaN(seconds) || seconds < 0) return 'æœªçŸ¥';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // æ›´æ–°å¤„ç†æ¨¡å¼
        function updateProcessMode() {
            const mode = document.querySelector('input[name="process-mode"]:checked').value;
            const processBtn = document.getElementById('process-btn');
            const processBtnText = document.getElementById('process-btn-text');
            
            if (mode === 'video') {
                processBtnText.textContent = 'å¤„ç†å®Œæ•´è§†é¢‘';
                processBtn.className = 'btn btn-success';
            } else {
                processBtnText.textContent = 'å¼€å§‹è¯†åˆ«';
                processBtn.className = 'btn btn-dark';
            }
        }

        // å¤„ç†è§†é¢‘ï¼ˆæ”¯æŒä¸¤ç§æ¨¡å¼ï¼‰
        async function processVideo() {
            // ç›´æ¥å¤„ç†å®Œæ•´è§†é¢‘
            await processFullVideo();
        }

        // å¤„ç†å®Œæ•´è§†é¢‘
        async function processFullVideo() {
            const fileInput = document.getElementById('video-frame');
            const file = fileInput.files[0];

            if (!file) {
                showNotification('error', 'è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºè§†é¢‘æ–‡ä»¶
            if (!file.type.startsWith('video/')) {
                showNotification('error', 'å®Œæ•´è§†é¢‘æ¨¡å¼éœ€è¦ä¸Šä¼ è§†é¢‘æ–‡ä»¶');
                return;
            }

            const processBtn = document.getElementById('process-btn');
            const processingDiv = document.getElementById('video-processing');
            const resultsDiv = document.getElementById('video-results');
            const progressBar = document.getElementById('progress-bar');
            const progressDiv = document.getElementById('video-progress');
            const processingText = document.getElementById('processing-text');

            // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
            processBtn.disabled = true;
            processBtn.innerHTML = '<div class="loading-spinner"></div> å¤„ç†ä¸­...';
            processingDiv.style.display = 'block';
            progressDiv.style.display = 'block';
            resultsDiv.style.display = 'none';
            processingText.textContent = 'æ­£åœ¨å¤„ç†è§†é¢‘ï¼Œè¯·è€å¿ƒç­‰å¾…...';

            const formData = new FormData();
            formData.append('video', file);
            
            // æ·»åŠ ç”µå½±èŒƒå›´å’Œç›¸ä¼¼åº¦å‚æ•°
            const movieScope = document.getElementById('movie-scope').value;
            const similarityThreshold = document.getElementById('similarity-threshold').value;
            
            if (movieScope) {
                formData.append('movie_title', movieScope);
            }
            formData.append('similarity_threshold', similarityThreshold);

            try {
                const response = await fetch('/api/process_video', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success && data.task_id) {
                    // å¼€å§‹ç›‘å¬è¿›åº¦
                    monitorVideoProgress(data.task_id, processBtn, processingDiv, resultsDiv, progressBar, processingText);
                } else {
                    showNotification('error', 'å¯åŠ¨è§†é¢‘å¤„ç†å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    processBtn.disabled = false;
                    processBtn.innerHTML = '<i class="bi bi-film"></i> å¤„ç†è§†é¢‘';
                    processingDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('å¯åŠ¨è§†é¢‘å¤„ç†å¤±è´¥:', error);
                showNotification('error', 'å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                processBtn.disabled = false;
                processBtn.innerHTML = '<i class="bi bi-film"></i> å¤„ç†è§†é¢‘';
                processingDiv.style.display = 'none';
            }
        }
        
        // ç›‘å¬è§†é¢‘å¤„ç†è¿›åº¦
        function monitorVideoProgress(taskId, processBtn, processingDiv, resultsDiv, progressBar, processingText) {
            const eventSource = new EventSource(`/api/video_progress/${taskId}`);
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    console.log('æ”¶åˆ°è¿›åº¦æ•°æ®:', data);
                    
                    if (data.type === 'progress') {
                        // æ›´æ–°è¿›åº¦æ¡
                        progressBar.style.width = `${data.progress}%`;
                        progressBar.setAttribute('aria-valuenow', data.progress);
                        
                        // æ›´æ–°è¿›åº¦æ–‡å­—
                        processingText.textContent = data.message;
                        
                    } else if (data.type === 'complete') {
                        // å¤„ç†å®Œæˆ
                        eventSource.close();
                        
                        if (data.success) {
                            displayVideoProcessingResults(data);
                            showNotification('success', `è§†é¢‘å¤„ç†å®Œæˆï¼æ€»è®¡å¤„ç† ${data.results.processed_frames} å¸§ï¼Œè¯†åˆ«å‡º ${data.results.faces_recognized} å¼ äººè„¸`);
                        } else {
                            showNotification('error', 'è§†é¢‘å¤„ç†å¤±è´¥: ' + (data.results.error || 'æœªçŸ¥é”™è¯¯'));
                        }
                        
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        processBtn.disabled = false;
                        processBtn.innerHTML = '<i class="bi bi-film"></i> å¤„ç†è§†é¢‘';
                        processingDiv.style.display = 'none';
                        
                    } else if (data.type === 'error') {
                        // å¤„ç†é”™è¯¯
                        eventSource.close();
                        showNotification('error', 'è§†é¢‘å¤„ç†å¤±è´¥: ' + data.error);
                        
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        processBtn.disabled = false;
                        processBtn.innerHTML = '<i class="bi bi-film"></i> å¤„ç†è§†é¢‘';
                        processingDiv.style.display = 'none';
                    }
                    
                } catch (e) {
                    console.error('è§£æè¿›åº¦æ•°æ®å¤±è´¥:', e);
                }
            };
            
            eventSource.onerror = function(event) {
                console.error('è¿›åº¦ç›‘å¬è¿æ¥é”™è¯¯:', event);
                eventSource.close();
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                processBtn.disabled = false;
                processBtn.innerHTML = '<i class="bi bi-film"></i> å¤„ç†è§†é¢‘';
                processingDiv.style.display = 'none';
                
                showNotification('error', 'è¿›åº¦ç›‘å¬è¿æ¥ä¸­æ–­');
            };
        }

        // å¤„ç†å•å¸§
        async function processVideoFrame() {
            const fileInput = document.getElementById('video-frame');
            const file = fileInput.files[0];

            if (!file) {
                showNotification('error', 'è¯·é€‰æ‹©æ–‡ä»¶');
                return;
            }

            const processBtn = document.getElementById('process-frame-btn');
            const processingDiv = document.getElementById('video-processing');
            const resultsDiv = document.getElementById('video-results');

            // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
            processBtn.disabled = true;
            processBtn.innerHTML = '<div class="loading-spinner"></div> è¯†åˆ«ä¸­...';
            processingDiv.style.display = 'block';
            resultsDiv.style.display = 'none';

            const formData = new FormData();
            formData.append('image', file);
            
            // æ·»åŠ ç”µå½±èŒƒå›´å’Œç›¸ä¼¼åº¦é˜ˆå€¼å‚æ•°
            const movieScope = document.getElementById('movie-scope').value;
            const similarityThreshold = document.getElementById('similarity-threshold').value;
            
            if (movieScope) {
                formData.append('movie_title', movieScope);
            }
            formData.append('similarity_threshold', similarityThreshold);

            try {
                const response = await fetch('/api/process_frame', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    displayVideoResults(data);
                    const fileTypeText = data.file_type === 'video' ? 'è§†é¢‘ç¬¬ä¸€å¸§' : 'å›¾ç‰‡';
                    showNotification('success', `${fileTypeText}è¯†åˆ«å®Œæˆï¼æ£€æµ‹åˆ° ${data.stats.faces_detected} å¼ äººè„¸ï¼Œè¯†åˆ«å‡º ${data.stats.faces_recognized} å¼ `);
                } else {
                    showNotification('error', 'å¤„ç†å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('å¤„ç†è§†é¢‘å¸§å¤±è´¥:', error);
                showNotification('error', 'å¤„ç†å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            } finally {
                processBtn.disabled = false;
                processBtn.innerHTML = '<i class="bi bi-play-fill"></i> å¼€å§‹è¯†åˆ«';
                processingDiv.style.display = 'none';
            }
        }
        
        // åŠ è½½ç”µå½±åˆ—è¡¨
        async function loadMoviesList() {
            try {
                const response = await fetch('/api/get_movies');
                const data = await response.json();
                
                if (data.success) {
                    const movieSelect = document.getElementById('movie-scope');
                    
                    // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼‰
                    while (movieSelect.children.length > 1) {
                        movieSelect.removeChild(movieSelect.lastChild);
                    }
                    
                    // æ·»åŠ ç”µå½±é€‰é¡¹
                    data.movies.forEach(movie => {
                        const option = document.createElement('option');
                        option.value = movie.title;
                        option.textContent = `${movie.title} (${movie.actor_count}ä½æ¼”å‘˜, ${movie.face_count}å¼ äººè„¸)`;
                        movieSelect.appendChild(option);
                    });
                    
                    console.log(`åŠ è½½äº† ${data.movies.length} éƒ¨ç”µå½±`);
                } else {
                    console.error('åŠ è½½ç”µå½±åˆ—è¡¨å¤±è´¥:', data.error);
                }
            } catch (error) {
                console.error('åŠ è½½ç”µå½±åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºè§†é¢‘è¯†åˆ«ç»“æœï¼ˆå•å¸§æ¨¡å¼ï¼‰
        function displayVideoResults(data) {
            const resultsDiv = document.getElementById('video-results');
            const frameResultDiv = document.getElementById('frame-result');
            const videoResultDiv = document.getElementById('video-result');
            const annotatedImg = document.getElementById('annotated-img');
            const statsDiv = document.getElementById('recognition-stats');
            const detailsDiv = document.getElementById('recognition-details');

            // æ˜¾ç¤ºå•å¸§ç»“æœï¼Œéšè—è§†é¢‘ç»“æœ
            frameResultDiv.style.display = 'block';
            videoResultDiv.style.display = 'none';

            // æ˜¾ç¤ºæ ‡æ³¨åçš„å›¾ç‰‡
            annotatedImg.src = data.annotated_image;

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const stats = data.stats;
            const movieScopeInfo = data.movie_scoped ? 
                `<div class="alert alert-info mt-2 mb-0">
                    <i class="bi bi-film"></i> ç”µå½±èŒƒå›´é™å®š: <strong>${data.target_movie}</strong>
                    <small class="d-block">è¯†åˆ«èŒƒå›´å·²é™åˆ¶åœ¨è¯¥ç”µå½±çš„æ¼”å‘˜ä¸­</small>
                </div>` : 
                `<div class="alert alert-secondary mt-2 mb-0">
                    <i class="bi bi-globe"></i> å…¨åº“æœç´¢
                    <small class="d-block">åœ¨æ‰€æœ‰æ¼”å‘˜ä¸­è¿›è¡Œè¯†åˆ«</small>
                </div>`;
            
            statsDiv.innerHTML = `
                <div class="row g-2">
                    <div class="col-4">
                        <div class="stats-card text-center">
                            <div class="stats-number">${stats.faces_detected}</div>
                            <div class="stats-label">æ£€æµ‹äººè„¸</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stats-card text-center">
                            <div class="stats-number">${stats.faces_recognized}</div>
                            <div class="stats-label">è¯†åˆ«æˆåŠŸ</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stats-card text-center">
                            <div class="stats-number">${stats.actors_found.length}</div>
                            <div class="stats-label">æ¼”å‘˜æ•°é‡</div>
                        </div>
                    </div>
                </div>
                ${movieScopeInfo}
            `;

            // æ˜¾ç¤ºè¯†åˆ«è¯¦æƒ…
            if (data.recognition_results && data.recognition_results.length > 0) {
                const detailsHtml = data.recognition_results.map((result, index) => {
                    const confidenceColor = result.confidence === 'high' ? 'success' : 
                                          result.confidence === 'medium' ? 'warning' : 'secondary';
                    
                    return `
                        <div class="database-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">
                                        ${result.recognized ? result.actor_name : 'æœªçŸ¥äººç‰©'}
                                        <span class="badge bg-${confidenceColor} ms-2">${result.confidence}</span>
                                    </h6>
                                    <small class="text-muted">
                                        ç›¸ä¼¼åº¦: ${(result.similarity * 100).toFixed(1)}% | 
                                        æ£€æµ‹åˆ†æ•°: ${result.det_score.toFixed(3)} |
                                        ${result.age ? `å¹´é¾„: ~${result.age}å²` : ''} |
                                        ${result.gender === 1 ? 'ç”·æ€§' : result.gender === 0 ? 'å¥³æ€§' : ''}
                                    </small>
                                </div>
                                <div class="text-muted">
                                    äººè„¸ #${index + 1}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                detailsDiv.innerHTML = `
                    <h6 class="mt-3">è¯†åˆ«è¯¦æƒ…ï¼š</h6>
                    ${detailsHtml}
                `;
            } else {
                detailsDiv.innerHTML = '<p class="text-muted mt-3">æœªæ£€æµ‹åˆ°äººè„¸</p>';
            }

            resultsDiv.style.display = 'block';
        }

        // æ˜¾ç¤ºè§†é¢‘å¤„ç†ç»“æœ
        function displayVideoProcessingResults(data) {
            const resultsDiv = document.getElementById('video-results');
            const frameResultDiv = document.getElementById('frame-result');
            const videoResultDiv = document.getElementById('video-result');
            const statsDiv = document.getElementById('recognition-stats');
            const detailsDiv = document.getElementById('recognition-details');
            const downloadBtn = document.getElementById('download-video-btn');

            // éšè—å•å¸§ç»“æœï¼Œæ˜¾ç¤ºè§†é¢‘ç»“æœ
            frameResultDiv.style.display = 'none';
            videoResultDiv.style.display = 'block';

            // è®¾ç½®ä¸‹è½½é“¾æ¥
            downloadBtn.onclick = function() {
                window.location.href = data.download_url;
            };

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const results = data.results;
            statsDiv.innerHTML = `
                <div class="row g-2">
                    <div class="col-3">
                        <div class="stats-card text-center">
                            <div class="stats-number">${results.total_frames || 0}</div>
                            <div class="stats-label">æ€»å¸§æ•°</div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="stats-card text-center">
                            <div class="stats-number">${results.faces_detected || 0}</div>
                            <div class="stats-label">æ£€æµ‹äººè„¸</div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="stats-card text-center">
                            <div class="stats-number">${results.faces_recognized || 0}</div>
                            <div class="stats-label">è¯†åˆ«æˆåŠŸ</div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="stats-card text-center">
                            <div class="stats-number">${results.actors_found ? results.actors_found.length : 0}</div>
                            <div class="stats-label">æ¼”å‘˜æ•°é‡</div>
                        </div>
                    </div>
                </div>
            `;

            // æ˜¾ç¤ºå¤„ç†è¯¦æƒ…
            if (results.actors_found && results.actors_found.length > 0) {
                const actorsHtml = results.actors_found.map(actor => `
                    <span class="badge bg-primary me-2 mb-2">${actor}</span>
                `).join('');
                
                detailsDiv.innerHTML = `
                    <h6 class="mt-3">è¯†åˆ«åˆ°çš„æ¼”å‘˜ï¼š</h6>
                    <div>${actorsHtml}</div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="bi bi-clock"></i> å¤„ç†æ—¶é—´: ${results.processing_time ? results.processing_time.toFixed(1) : 0} ç§’ |
                            <i class="bi bi-file-earmark-play"></i> è¾“å‡ºæ–‡ä»¶: ${data.output_filename}
                        </small>
                    </div>
                `;
            } else {
                detailsDiv.innerHTML = '<p class="text-muted mt-3">è§†é¢‘ä¸­æœªè¯†åˆ«åˆ°ä»»ä½•å·²çŸ¥æ¼”å‘˜</p>';
            }

            resultsDiv.style.display = 'block';
        }

        // åˆå§‹åŒ–å¹³æ»‘æ»šåŠ¨
        function initSmoothScroll() {
            document.querySelectorAll('.smooth-scroll').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }

        // ç¡®ä¿åœ¨DOMContentLoadedåå†æ¬¡åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOMå†…å®¹åŠ è½½å®Œæˆï¼Œæ‰§è¡Œé¢å¤–åˆå§‹åŒ–...');
                updateThresholdValue();
                initSmoothScroll();
            });
        } else {
            console.log('DOMå·²ç»åŠ è½½å®Œæˆ');
            updateThresholdValue();
            initSmoothScroll();
        }
    </script>
</body>
</html>
