# 🔄 项目更新指南

## 📥 首次获取项目

### 方法1: 克隆项目（推荐）

```bash
# 克隆项目到本地
git clone https://github.com/hellowydwyd/Actor_Dataset_Construct.git
cd Actor_Dataset_Construct
```

### 方法2: 下载ZIP文件

1. 访问 [GitHub项目页面](https://github.com/hellowydwyd/Actor_Dataset_Construct)
2. 点击绿色的 "Code" 按钮
3. 选择 "Download ZIP"
4. 解压到本地目录

## 🔧 环境配置

### 1. 安装Python依赖

```bash
# 安装所有必需的依赖包
pip install -r requirements.txt

# 如果在中国，可能需要使用国内镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
```

### 2. 配置TMDB API密钥

#### 获取API密钥：
1. 访问 [TMDB官网](https://www.themoviedb.org/)
2. 注册并登录账户
3. 进入 [API设置页面](https://www.themoviedb.org/settings/api)
4. 申请API密钥（选择"Developer"）

#### 配置密钥：
```bash
# 编辑配置文件
vim config/config.yaml
# 或者使用任何文本编辑器

# 在文件中找到以下部分并替换API密钥：
tmdb:
  api_key: "your_tmdb_api_key_here"  # 替换为你的真实API密钥
```

### 3. 创建必要的目录

```bash
# 项目会自动创建这些目录，但可以手动创建
mkdir -p data/images
mkdir -p data/embeddings
mkdir -p data/metadata
mkdir -p logs
mkdir -p temp
```

## 🚀 启动项目

### Web界面模式（推荐）

```bash
# 启动Web服务
python web/app.py

# 或者使用main.py启动
python main.py

# 然后在浏览器中访问
http://localhost:5000
```

### 命令行模式

```bash
# 构建数据集
python main.py

# 处理视频
python scripts/video_recognition.py --input video.mp4 --output result.mp4
```

## 🔄 获取项目更新

### 如果你使用Git克隆（推荐）

```bash
# 进入项目目录
cd Actor_Dataset_Construct

# 拉取最新更新
git pull origin main

# 如果有新的依赖，重新安装
pip install -r requirements.txt

# 重新启动项目
python web/app.py
```

### 如果你下载了ZIP文件

1. 备份你的配置文件和数据：
   ```bash
   # 备份重要文件
   cp config/config.yaml config/config_backup.yaml
   cp -r data/ data_backup/
   ```

2. 下载新版本的ZIP文件
3. 解压并替换项目文件
4. 恢复你的配置：
   ```bash
   # 恢复配置文件
   cp config/config_backup.yaml config/config.yaml
   # data目录通常不需要恢复，除非你有重要的自定义数据
   ```

5. 重新安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

## ⚠️ 重要注意事项

### 🔐 保护你的数据

在更新前，请备份以下重要文件：

```bash
# 备份配置文件（包含API密钥）
cp config/config.yaml config/config_backup.yaml

# 备份数据库文件
cp data/embeddings/faiss_index.bin data/embeddings/faiss_index_backup.bin
cp data/embeddings/metadata.pkl data/embeddings/metadata_backup.pkl
cp data/embeddings/id_mapping.json data/embeddings/id_mapping_backup.json

# 备份角色颜色配置
cp data/metadata/color_config.json data/metadata/color_config_backup.json
```

### 📦 依赖包更新

如果更新后出现依赖问题：

```bash
# 重新安装所有依赖
pip install -r requirements.txt --force-reinstall

# 或者使用虚拟环境（推荐）
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate     # Windows

pip install -r requirements.txt
```

### 🗄️ 数据库兼容性

项目更新可能会改变数据库结构，如果遇到数据库相关错误：

```bash
# 重新构建数据库（会丢失现有数据）
python main.py --rebuild-database

# 或者删除现有数据库文件让系统重新创建
rm data/embeddings/faiss_index.bin
rm data/embeddings/metadata.pkl
rm data/embeddings/id_mapping.json
```

## 🆘 常见问题解决

### 依赖包问题

```bash
# 如果遇到包冲突，创建新的虚拟环境
python -m venv fresh_env
source fresh_env/bin/activate  # Linux/Mac
# 或
fresh_env\Scripts\activate     # Windows

pip install -r requirements.txt
```

### TMDB API问题

```bash
# 测试TMDB API是否正常
python tests/standalone_tmdb_test.py

# 如果API密钥有问题，重新配置
vim config/config.yaml
```

### InsightFace模型问题

```bash
# 如果人脸识别模型有问题，重新下载
python -c "import insightface; app = insightface.app.FaceAnalysis(name='buffalo_l')"
```

## 📋 更新检查清单

在每次更新后，请检查：

- [ ] ✅ Git拉取成功，没有冲突
- [ ] ✅ 依赖包安装完成
- [ ] ✅ 配置文件包含正确的API密钥
- [ ] ✅ Web服务能正常启动
- [ ] ✅ 数据库加载正常
- [ ] ✅ 人脸识别功能正常
- [ ] ✅ 视频处理功能正常

## 🔧 开发者模式

如果你想参与开发或自定义功能：

```bash
# Fork项目后克隆你的版本
git clone https://github.com/YOUR_USERNAME/Actor_Dataset_Construct.git
cd Actor_Dataset_Construct

# 添加原始仓库作为upstream
git remote add upstream https://github.com/hellowydwyd/Actor_Dataset_Construct.git

# 获取最新更新
git fetch upstream
git merge upstream/main

# 创建功能分支
git checkout -b feature/your-feature-name

# 开发完成后提交
git add .
git commit -m "Add your feature"
git push origin feature/your-feature-name

# 然后在GitHub上创建Pull Request
```

## 📞 获取帮助

如果在更新过程中遇到问题：

1. **查看日志文件**: `logs/system.log`
2. **运行测试脚本**: `python tests/test_system.py`
3. **提交Issue**: 在GitHub项目页面提交问题
4. **查看文档**: `docs/` 目录中的相关文档

## 🎯 版本兼容性

- **Python**: 需要3.8或更高版本
- **操作系统**: Windows, Linux, macOS都支持
- **内存**: 建议2GB以上RAM
- **存储**: 建议5GB以上可用空间

---

*定期更新项目以获取最新功能和bug修复！*

