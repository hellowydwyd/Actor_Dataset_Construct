# 演员数据集构建项目目录结构

## 📁 项目整体架构

```
Actor_dataset_contruct/
├── 📁 项目根目录文件
├── 📁 config/          # 配置文件
├── 📁 data/            # 数据存储
├── 📁 docs/            # 项目文档
├── 📁 examples/        # 示例代码
├── 📁 logs/            # 日志文件
├── 📁 scripts/         # 工具脚本
├── 📁 src/             # 核心源代码
├── 📁 temp/            # 临时文件
├── 📁 tests/           # 测试代码
└── 📁 web/             # Web界面
```

## 📋 详细目录结构

### 🔧 项目根目录文件
```
├── main.py              # 主程序入口
├── run.py               # 运行脚本
├── README.md            # 项目说明
├── requirements.txt     # Python依赖包
└── .gitignore          # Git忽略文件
```

### ⚙️ config/ - 配置文件
```
config/
├── config.yaml          # 主配置文件
└── env_example          # 环境变量示例
```

**主要配置内容**:
- TMDB API配置
- 图片爬取策略
- 人脸识别参数
- 向量数据库配置
- 视频处理参数

### 📊 data/ - 数据存储
```
data/
├── embeddings/          # 向量数据库文件
│   ├── faiss_index.bin  # Faiss索引文件
│   ├── id_mapping.json  # ID映射关系
│   └── metadata.pkl     # 元数据文件
├── images/              # 图片数据
│   ├── aligned_faces/   # 对齐后的人脸图片
│   ├── 教父/            # 按电影分类的原始图片
│   ├── 流浪地球2/       # 
│   └── 肖申克的救赎/    # 
└── metadata/            # 元数据配置
    └── color_config.json # 角色颜色配置
```

**图片目录结构**:
- 按电影名称分类
- 每个演员一个子目录：`{演员ID}_{演员名字}/`
- 图片命名：`{演员名}_{序号}_{尺寸}_score{质量分}.jpg`

### 📚 docs/ - 项目文档
```
docs/
├── 中文文字渲染解决方案.md      # 中文显示技术方案
├── 图片目录结构迁移说明.md      # 目录结构说明
├── 核心业务逻辑流程图.md        # 业务流程图
├── 爬虫优化说明.md             # 爬虫技术优化
├── 系统流程图.md               # 系统架构图
├── 视频预览功能优化说明.md      # 视频预览功能
├── 长电影处理指南.md           # 长视频处理指南
└── 项目目录结构说明.md         # 本文档
```

### 💡 examples/ - 示例代码
```
examples/
├── long_movie_processing.py    # 长电影处理示例
├── process_video_demo.py       # 视频处理演示
└── process_video_enhanced.py   # 增强视频处理
```

### 📝 logs/ - 日志文件
```
logs/
└── system.log          # 系统运行日志
```

### 🛠️ scripts/ - 工具脚本
```
scripts/
├── migrate_image_structure.py  # 图片目录迁移工具
├── test_chinese_text.py        # 中文文字测试
└── video_recognition.py        # 视频识别工具
```

### 🔥 src/ - 核心源代码
```
src/
├── api/                 # 外部API接口
│   ├── tmdb_client.py   # TMDB API客户端
│   └── __init__.py
├── crawler/             # 图片爬取模块
│   ├── image_crawler.py # 纯TMDB图片爬虫
│   └── __init__.py
├── database/            # 数据库模块
│   ├── vector_database.py # 向量数据库管理
│   └── __init__.py
├── face_recognition/    # 人脸识别模块
│   ├── face_processor.py # 人脸处理器
│   └── __init__.py
├── utils/               # 工具模块
│   ├── chinese_text_renderer.py # 中文文字渲染
│   ├── color_manager.py         # 颜色管理
│   ├── config_loader.py         # 配置加载器
│   ├── logger.py                # 日志工具
│   └── __init__.py
├── video_recognition/   # 视频识别模块
│   ├── video_processor.py # 视频处理器
│   └── __init__.py
└── __init__.py
```

### 🧪 tests/ - 测试代码
```
tests/
├── simple_test.py                  # 简单功能测试
├── standalone_tmdb_test.py         # 独立TMDB测试
├── test_3_photos.py                # 三张图片测试
├── test_character_name_fix.py      # 角色名字修复测试
├── test_new_tmdb_crawler.py        # 新TMDB爬虫测试
├── test_system.py                  # 系统集成测试
├── test_video_modifications.py    # 视频修改功能测试
└── temp/                           # 测试临时文件
    └── tmdb_test_images/           # TMDB测试图片
```

### 🌐 web/ - Web界面
```
web/
├── app.py               # Flask应用主文件
├── static/              # 静态资源（CSS、JS、图片）
├── templates/           # HTML模板
│   └── index.html       # 主页面模板
└── __pycache__/         # Python缓存
```

### 🗂️ temp/ - 临时文件
```
temp/
├── character_name_test.jpg          # 角色名字测试图片
├── chinese_text_test.jpg            # 中文文字测试图片
├── enhanced_recognition_result.mp4  # 增强识别结果视频
├── input_test*.mp4                  # 测试输入视频
├── processed_test*.mp4              # 处理后的视频
├── test_*.jpg                       # 各种测试图片
└── standalone_tmdb_images/          # 独立TMDB测试图片
    ├── standalone_tmdb_results.json # 测试结果
    └── {演员ID}_{演员名}/           # 按演员分类的图片
```

## 🔄 数据流向

```
1. 输入电影名 → TMDB API → 获取演员列表
2. 演员列表 → TMDB图片API → 下载所有图片
3. 原始图片 → 人脸检测 → 人脸对齐 → 特征提取
4. 人脸特征 → 向量数据库 → 构建索引
5. 视频输入 → 帧提取 → 人脸检测 → 特征匹配 → 角色标注
```

## 📈 核心模块关系

```
main.py (主控制器)
├── TMDBClient (API客户端)
├── ImageCrawler (图片爬取)
├── FaceProcessor (人脸处理)
├── VectorDatabaseManager (向量数据库)
├── VideoFaceRecognizer (视频识别)
├── ColorManager (颜色管理)
└── ChineseTextRenderer (文字渲染)
```

## 🎯 关键特性

### 🔍 人脸识别技术栈
- **InsightFace**: 高精度人脸检测和特征提取
- **Faiss**: 高性能向量相似度搜索
- **OpenCV**: 图像处理和视频处理

### 🎨 可视化功能
- **角色专属颜色**: 每个角色独特的标注颜色
- **描边文字**: 无背景填充的清晰文字标注
- **多种框形**: 矩形、圆形、椭圆等标注框

### 🚀 性能优化
- **长视频模式**: 智能跳帧和内存管理
- **并行处理**: 多线程图片下载和处理
- **检查点恢复**: 支持长视频的断点续传

### 🌐 Web界面
- **实时进度**: SSE实时进度更新
- **可视化结果**: 直观的识别结果展示
- **交互操作**: 演员管理和参数调整

## 📦 依赖关系

### 核心依赖
- `insightface`: 人脸识别算法
- `faiss-cpu`: 向量相似度搜索
- `opencv-python`: 计算机视觉
- `requests`: HTTP请求
- `flask`: Web框架

### 辅助依赖  
- `pillow`: 图像处理
- `numpy`: 数值计算
- `loguru`: 日志系统
- `pyyaml`: 配置文件解析

## 🎮 使用方式

### 命令行模式
```bash
# 构建数据集
python main.py

# 处理视频
python run.py --video input.mp4 --output result.mp4
```

### Web界面模式
```bash
# 启动Web服务
python web/app.py

# 访问 http://localhost:5000
```

## 📊 数据统计

### 当前数据集规模
- **向量数据库**: 44个人脸向量
- **支持电影**: 教父、流浪地球2、肖申克的救赎
- **演员数量**: 约30位知名演员
- **图片总数**: 约200张高质量图片

### 处理能力
- **图片处理**: 支持批量处理和质量筛选
- **视频处理**: 支持长视频优化和实时进度
- **识别精度**: 相似度阈值可调节（默认0.6）

---

*本文档描述了演员数据集构建项目的完整目录结构和功能模块，为开发和维护提供参考。*
