# 国内部署方案推荐

## 🇨🇳 中国国内云平台对比

| 平台 | 免费额度 | 优势 | 适用性 | 推荐度 |
|------|----------|------|--------|--------|
| **腾讯云 Cloud Studio** | ✅ 完全免费 | 代码托管+运行环境 | 开发演示 | ⭐⭐⭐⭐⭐ |
| **阿里云 PAI-DSW** | 🟡 有限免费 | AI/ML优化 | AI应用 | ⭐⭐⭐⭐ |
| **华为云 ModelArts** | 🟡 试用额度 | 企业级AI平台 | 正式部署 | ⭐⭐⭐⭐ |
| **百度智能云 AI Studio** | ✅ 免费GPU时长 | AI开发环境 | AI项目 | ⭐⭐⭐⭐ |
| **腾讯云轻量应用服务器** | 🔴 付费 | 简单易用 | 小型应用 | ⭐⭐⭐ |
| **阿里云 ECS** | 🔴 付费 | 功能完整 | 企业应用 | ⭐⭐⭐ |

## 🏆 主推荐：腾讯云 Cloud Studio

### 为什么最适合您的项目？

```yaml
✅ 完全免费:
- 无时间限制
- 2GB内存 + 1核CPU
- 10GB存储空间
- 内置Git支持

✅ AI友好:
- 预装Python环境
- 支持机器学习库
- 网络访问稳定

✅ 操作简单:
- 基于浏览器
- 一键创建环境
- 无需配置
```

### 部署步骤

#### 1. 访问 Cloud Studio
- 网址：https://cloudstudio.net/
- 使用微信/QQ登录

#### 2. 创建工作空间
```bash
# 选择模板：Python 3.9
# 配置：
CPU: 1核
内存: 2GB  
存储: 10GB
```

#### 3. 克隆项目
```bash
git clone https://github.com/your-username/Actor_dataset_construct.git
cd Actor_dataset_construct
```

#### 4. 安装依赖
```bash
# 使用国内镜像源加速
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
```

#### 5. 运行应用
```bash
python main.py web --host 0.0.0.0 --port 8080
```

#### 6. 访问应用
Cloud Studio会自动提供公网访问地址

## 🥈 备选方案：百度 AI Studio

### 特点
```yaml
✅ 专为AI优化:
- 免费GPU时长
- 预装AI框架
- 数据集管理

✅ 资源配置:
- 基础版: 免费
- 高级版: 按时计费
- GPU版: AI计算优化
```

### 部署步骤

#### 1. 注册 AI Studio
- 网址：https://aistudio.baidu.com/
- 实名认证获得更多资源

#### 2. 创建项目
```bash
# 选择环境：
Python: 3.7+
框架: PaddlePaddle/PyTorch
资源: CPU/GPU可选
```

#### 3. 上传代码
- 使用Notebook环境
- 或直接克隆GitHub仓库

## 🥉 企业级方案：阿里云 PAI

### 适用场景
- 企业正式部署
- 大规模AI应用
- 需要高可用性

### 优势
```yaml
✅ 企业级特性:
- 弹性伸缩
- 负载均衡
- 监控告警
- 数据安全

💰 成本:
- 按量付费
- 预付费优惠
- 企业折扣
```

## 🛠️ 国内环境优化配置

### 1. 依赖源配置

创建 `requirements-china.txt`：
```bash
# 使用国内镜像源
-i https://pypi.tuna.tsinghua.edu.cn/simple

requests==2.31.0
beautifulsoup4==4.12.2
pillow==10.0.1
numpy==1.24.3
opencv-python==4.8.1.78
insightface==0.7.3
onnxruntime==1.16.3
scikit-learn==1.3.0
faiss-cpu==1.7.4
flask==3.0.0
flask-cors==4.0.0
tmdbv3api==1.9.0
tqdm==4.66.1
python-dotenv==1.0.0
pyyaml==6.0.1
loguru==0.7.2
```

### 2. 网络优化配置

`config/config.china.yaml`：
```yaml
# 中国环境优化配置

# API配置 - 考虑网络延迟
tmdb:
  api_key: "${TMDB_API_KEY}"
  timeout: 30                    # 增加超时时间
  retry_count: 3                 # 增加重试次数
  retry_delay: 2                 # 重试延迟

# 爬虫配置 - 网络优化
crawler:
  download_timeout: 30           # 增加下载超时
  concurrent_downloads: 2        # 降低并发数
  request_delay: 1               # 增加请求间隔
  user_agent: "Mozilla/5.0 (compatible; ActorCrawler/1.0)"
  
  sources:
    - name: "tmdb_images"
      enabled: true
      max_results: 8
      timeout: 20
    - name: "baidu_images"  
      enabled: false             # 可选择启用百度搜索

# 性能优化
performance:
  enable_cache: true             # 启用缓存
  cache_timeout: 3600           # 缓存1小时
  max_memory_usage: 1.5         # 限制内存使用 (GB)
```

### 3. 启动脚本优化

`run_china.py`：
```python
#!/usr/bin/env python3
"""
中国环境优化启动脚本
"""
import os
import sys
from pathlib import Path

# 设置环境变量
os.environ['PYTHONIOENCODING'] = 'utf-8'
os.environ['TZ'] = 'Asia/Shanghai'

# 添加项目路径
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

from web.app import create_app
from src.utils.logger import get_logger

logger = get_logger(__name__)

if __name__ == '__main__':
    try:
        # 设置中文环境
        import locale
        try:
            locale.setlocale(locale.LC_ALL, 'zh_CN.UTF-8')
        except:
            pass
        
        # 创建应用
        app = create_app()
        
        # 配置参数
        host = os.getenv('HOST', '0.0.0.0')
        port = int(os.getenv('PORT', 8080))
        debug = os.getenv('DEBUG', 'false').lower() == 'true'
        
        logger.info(f"启动中国优化版本... (Host: {host}, Port: {port})")
        app.run(host=host, port=port, debug=debug)
        
    except Exception as e:
        logger.error(f"启动失败: {e}")
        raise
```

## 💰 成本对比

| 方案 | 月成本 | 资源配置 | 适用阶段 |
|------|--------|----------|----------|
| **腾讯云 Cloud Studio** | ¥0 | 1核2G | 开发/演示 |
| **百度 AI Studio** | ¥0-50 | 可选GPU | AI开发 |
| **阿里云 PAI** | ¥100-500 | 弹性配置 | 生产环境 |
| **腾讯云轻量服务器** | ¥24-288 | 1-8核 | 小型应用 |

## 🚀 快速部署指南

### 推荐流程：腾讯云 Cloud Studio

```bash
# 1. 访问 https://cloudstudio.net/
# 2. 创建Python工作空间
# 3. 在终端执行：

git clone https://github.com/your-repo.git
cd Actor_dataset_construct

# 使用国内源安装依赖
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt

# 创建环境变量文件
cp env.example .env
# 编辑 .env 文件，添加 TMDB_API_KEY

# 启动应用
python run_china.py

# 应用会自动分配公网地址，可直接访问
```

## 🔧 故障排除

### 常见问题

1. **网络连接问题**
```bash
# 使用国内DNS
export DNS_SERVER=114.114.114.114
```

2. **依赖安装慢**
```bash
# 使用清华大学镜像源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

3. **TMDB API访问慢**
```bash
# 增加超时时间和重试
# 在config中设置更长的timeout值
```

4. **内存不足**
```bash
# 减少并发处理
# 使用更小的图片尺寸
# 启用模型懒加载
```

## 📋 推荐配置总结

### 🏆 最佳方案：腾讯云 Cloud Studio
- **成本**: 完全免费
- **适用**: 开发、演示、小规模使用
- **优势**: 零配置、即开即用
- **网址**: https://cloudstudio.net/

### 🥈 AI专用：百度 AI Studio  
- **成本**: 基础免费 + 高级付费
- **适用**: AI项目专业开发
- **优势**: AI优化、GPU支持
- **网址**: https://aistudio.baidu.com/

选择腾讯云 Cloud Studio作为首选，它完全免费且非常适合您的项目演示和开发需求！
